{"version":3,"sources":["../src/modal_help.js"],"names":["define","$","Modal","ModalRegistry","ModalEvents","KeyCodes","CustomEvents","Notification","Templates","ModalHelpAjax","registered","SELECTORS","SEARCH","SEARCH_BUTTON","SUGGESTIONS","SUGGESTION_ITEM","TEMPLATES","MODAL_HELP_CONTENT","MODAL_HELP_TOPICS","ModalHelp","root","call","searchBox","find","searchButton","suggestionBox","topicList","suggestionIndex","prototype","Object","create","constructor","TYPE","registerEventListeners","getRoot","on","shown","getRemtlHelp","then","response","renderPromise","render","html","setBody","catch","exception","getTopicList","topics","js","replaceNodeContents","hidden","val","addClass","e","target","getModal","removeClass","searchValue","regex","RegExp","split","join","suggestionItems","suggestions","length","eq","topic","match","exec","title","push","text","url","start","index","sort","a","b","suggestion","matchingSuggestion","filter","visibleSuggestions","keyCode","arrowDown","arrowRight","arrowUp","arrowLeft","currentTarget","register"],"mappings":"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","sourcesContent":["define(\n[\n    'jquery',\n    'core/modal',\n    'core/modal_registry',\n    'core/modal_events',\n    'core/key_codes',\n    'core/custom_interaction_events',\n    'core/notification',\n    'core/templates',\n    'theme_urcourses_default/modal_help_ajax'\n],\nfunction(\n    $,\n    Modal,\n    ModalRegistry,\n    ModalEvents,\n    KeyCodes,\n    CustomEvents,\n    Notification,\n    Templates,\n    ModalHelpAjax\n) {\n    var registered = false;\n\n    var SELECTORS = {\n        SEARCH: '#modal_help_search',\n        SEARCH_BUTTON: '#modal_help_search_btn',\n        SUGGESTIONS: '#modal_help_search_suggestions',\n        SUGGESTION_ITEM: '.modal-help-suggestion-item'\n    };\n\n    var TEMPLATES = {\n        MODAL_HELP_CONTENT: 'theme_urcourses_default/modal_help_content',\n        MODAL_HELP_TOPICS: 'theme_urcourses_default/modal_help_topics'\n    };\n\n    /*\n     * Modal constructor.\n     *\n     * @param {object} root The root jQuery element for the modal.\n     */\n    var ModalHelp = function(root) {\n        Modal.call(this, root);\n        this.searchBox = this.root.find(SELECTORS.SEARCH);\n        this.searchButton = this.root.find(SELECTORS.SEARCH_BUTTON);\n        this.suggestionBox = this.root.find(SELECTORS.SUGGESTIONS);\n        this.topicList = null;\n        this.suggestionIndex = 0;\n    };\n\n    ModalHelp.prototype = Object.create(Modal.prototype);\n    ModalHelp.prototype.constructor = ModalHelp;\n    ModalHelp.TYPE = 'theme_urcourses_default-help';\n\n    /**\n     * Set up event handling.\n     *\n     * @method registerEventListeners\n     */\n    ModalHelp.prototype.registerEventListeners = function() {\n        Modal.prototype.registerEventListeners.call(this);\n\n        this.getRoot().on(ModalEvents.shown, () => {\n            ModalHelpAjax.getRemtlHelp()\n            .then((response) => {\n                var renderPromise = Templates.render(TEMPLATES.MODAL_HELP_CONTENT, {html: response.html});\n                return this.setBody(renderPromise);\n            }).catch(Notification.exception);\n\n            if (this.topicList === null) {\n                ModalHelpAjax.getTopicList()\n                .then((response) => {\n                    this.topicList = response;\n                    return Templates.render(TEMPLATES.MODAL_HELP_TOPICS, {topics: response});\n                })\n                .then((html, js) => {\n                    return Templates.replaceNodeContents(SELECTORS.SUGGESTIONS, html, js);\n                }).catch(Notification.exception);\n            }\n        });\n\n        this.getRoot().on(ModalEvents.hidden, () => {\n            this.setBody('');\n            this.searchBox.val('');\n            this.suggestionBox.addClass('d-none');\n        });\n\n        this.getRoot().on('click', (e) => {\n            var target = e.target;\n            var searchBox = this.searchBox[0];\n            var suggestionBox = this.suggestionBox[0];\n            if (!(target === searchBox) && !(target === suggestionBox)) {\n                this.suggestionBox.addClass('d-none');\n            }\n        });\n\n        this.getModal().on('focus', SELECTORS.SEARCH, () => {\n            this.suggestionBox.removeClass('d-none');\n        });\n\n        this.getModal().on('input', SELECTORS.SEARCH, () => {\n            var searchValue = this.searchBox.val();\n            var regex = RegExp(searchValue.split('').join('.*'), 'i');\n            var suggestionItems = $(SELECTORS.SUGGESTION_ITEM);\n            var suggestions = [];\n            suggestionItems.addClass('d-none');\n            suggestionItems.removeClass('selected');\n            if (!searchValue.length) {\n                suggestionItems.eq(0).addClass('selected');\n                suggestionItems.removeClass('d-none');\n                return;\n            }\n            for (var topic of this.topicList) {\n                var match = regex.exec(topic.title);\n                if (match) {\n                    suggestions.push({\n                        text: topic.title,\n                        url: topic.url,\n                        length: match[0].length,\n                        start: match.index\n                    });\n                }\n            }\n            suggestions.sort((a, b) => {\n                if (a.length < b.length) {\n                    return -1;\n                }\n                if (a.length > b.length) {\n                    return 1;\n                }\n                if (a.start < b.start) {\n                    return -1;\n                }\n                if (a.start > b.start) {\n                    return 1;\n                }\n            });\n            for (var suggestion of suggestions) {\n                var matchingSuggestion = suggestionItems.filter(`[data-value=\"${suggestion.text}\"]`);\n                matchingSuggestion.removeClass('d-none');\n            }\n            suggestionItems.filter(':not(.d-none)').eq(0).addClass('selected');\n        });\n\n        this.getModal().on('keydown', SELECTORS.SEARCH, (e) => {\n            var visibleSuggestions = $(SELECTORS.SUGGESTION_ITEM).filter(':not(.d-none)');\n            if (e.keyCode === KeyCodes.arrowDown || e.keyCode === KeyCodes.arrowRight) {\n                this.suggestionIndex++;\n                if (this.suggestionIndex >= visibleSuggestions.length) {\n                    this.suggestionIndex = 0;\n                }\n                visibleSuggestions.removeClass('selected');\n                visibleSuggestions.eq(this.suggestionIndex).addClass('selected');\n            } else if (e.keyCode === KeyCodes.arrowUp || e.keyCode === KeyCodes.arrowLeft) {\n                this.suggestionIndex--;\n                if (this.suggestionIndex < 0) {\n                    this.suggestionIndex = visibleSuggestions.length - 1;\n                }\n                visibleSuggestions.removeClass('selected');\n                visibleSuggestions.eq(this.suggestionIndex).addClass('selected');\n            }\n        });\n\n        this.getModal().on('mouseover', SELECTORS.SUGGESTION_ITEM, (e) => {\n            $(SELECTORS.SUGGESTION_ITEM).removeClass('selected');\n            $(e.currentTarget).addClass('selected');\n        });\n    };\n\n    if (!registered) {\n        ModalRegistry.register(ModalHelp.TYPE, ModalHelp, 'theme_urcourses_default/modal_help');\n        registered = true;\n    }\n\n    return ModalHelp;\n});\n"],"file":"modal_help.min.js"}