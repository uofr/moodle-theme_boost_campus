{"version":3,"sources":["../src/modal_help.js"],"names":["define","$","Modal","ModalRegistry","ModalEvents","KeyCodes","CustomEvents","Notification","Templates","ModalHelpAjax","registered","SELECTORS","SEARCH","SEARCH_BUTTON","SUGGESTIONS","SUGGESTION_ITEM","LOADING_OVERLAY","ModalHelp","root","call","searchBox","find","searchButton","suggestionBox","suggestionItemIndex","topicsList","prototype","Object","create","constructor","TYPE","registerEventListeners","getRoot","on","shown","getRemtlHelp","then","response","setBody","html","getTopicList","hidden","val","getModal","searchValue","regex","RegExp","split","join","suggestions","length","topic","match","exec","title","push","text","start","index","sort","a","b","suggestion","append","e","keyCode","arrowUp","preventDefault","eq","focus","arrowDown","arrowLeft","arrowRight","bind","escape","events","activate","keyboardActivate","attr","register"],"mappings":"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","sourcesContent":["define(\n[\n    'jquery',\n    'core/modal',\n    'core/modal_registry',\n    'core/modal_events',\n    'core/key_codes',\n    'core/custom_interaction_events',\n    'core/notification',\n    'core/templates',\n    'theme_urcourses_default/modal_help_ajax'\n],\nfunction(\n    $,\n    Modal,\n    ModalRegistry,\n    ModalEvents,\n    KeyCodes,\n    CustomEvents,\n    Notification,\n    Templates,\n    ModalHelpAjax\n) {\n    var registered = false;\n\n    var SELECTORS = {\n        SEARCH: '#modal_help_search',\n        SEARCH_BUTTON: '#modal_help_search_btn',\n        SUGGESTIONS: '#modal_help_search_suggestions',\n        SUGGESTION_ITEM: '.suggestion-item',\n        LOADING_OVERLAY: '[data-region=\"overlay-icon-container\"]'\n    };\n\n    var TEMPLATES = {\n        MODAL_HELP_CONTENT: 'theme_urcourses_default/modal_help_content'\n    };\n\n    /**\n     * Modal constructor.\n     *\n     * @param {object} root The root jQuery element for the modal.\n     */\n    var ModalHelp = function(root) {\n        Modal.call(this, root);\n        this.searchBox = this.root.find(SELECTORS.SEARCH);\n        this.searchButton = this.root.find(SELECTORS.SEARCH_BUTTON);\n        this.suggestionBox = this.root.find(SELECTORS.SUGGESTIONS);\n        this.suggestionItemIndex = 0;\n        this.topicsList = null;\n    };\n\n    ModalHelp.prototype = Object.create(Modal.prototype);\n    ModalHelp.prototype.constructor = ModalHelp;\n    ModalHelp.TYPE = 'theme_urcourses_default-help';\n\n    /**\n     * Set up event handling.\n     *\n     * @method registerEventListeners\n     */\n    ModalHelp.prototype.registerEventListeners = function() {\n        Modal.prototype.registerEventListeners.call(this);\n\n        this.getRoot().on(ModalEvents.shown, () => {\n            // get default content\n            ModalHelpAjax.getRemtlHelp()\n            .then((response) => {\n                this.setBody(response.html);\n            });\n            // if topic list is null, get the list\n            // otherwise, it's been set already and we don't need to do an ajax request\n            if (this.topicsList === null) {\n                ModalHelpAjax.getTopicList()\n                .then((response) => {\n                    this.topicsList = response;\n                });\n            }\n        });\n\n        this.getRoot().on(ModalEvents.hidden, () => {\n            this.setBody('');\n            this.searchBox.val('');\n            this.suggestionBox.html('');\n        });\n\n        this.getModal().on('input', SELECTORS.SEARCH, (e, data) => {\n            // this function should do nothing until the list is loaded\n            if (this.topicsList === null) {\n                return;\n            }\n            var searchValue = this.searchBox.val();\n            var regex = RegExp(searchValue.split('').join('.*'), 'i');\n            var suggestions = [];\n            this.suggestionBox.html('');\n            if (!searchValue.length) {\n                return;\n            }\n            for (var topic of this.topicsList) {\n                var match = regex.exec(topic.title);\n                if (match) {\n                    suggestions.push({\n                        text: topic.title,\n                        length: match[0].length,\n                        start: match.index\n                    });\n                }\n            }\n            suggestions.sort(function(a, b) {\n                if (a.length < b.length) {\n                    return -1;\n                }\n                if (a.length > b.length) {\n                    return 1;\n                }\n                if (a.start < b.start) {\n                    return -1;\n                }\n                if (a.start > b.start) {\n                    return 1;\n                }\n            });\n            for (var suggestion of suggestions) {\n                var html = `<a href=\"#\" class=\"modal-help-suggestion-item\" data-value=\"${suggestion.text}\">${suggestion.text}</a>`;\n                this.suggestionBox.append(html);\n            }\n        });\n\n        this.getModal().on('keydown', SELECTORS.SEARCH, function(e, data) {\n            switch (e.keyCode) {\n                case KeyCodes.arrowUp:\n                    e.preventDefault();\n                    this.suggestionItemIndex = this.getModal().find(SELECTORS.SUGGESTION_ITEM).length - 1;\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n                case KeyCodes.arrowDown:\n                    e.preventDefault();\n                    this.suggestionItemIndex = 0;\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n                case KeyCodes.arrowLeft:\n                     e.preventDefault();\n                    this.suggestionItemIndex = this.getModal().find(SELECTORS.SUGGESTION_ITEM).length - 1;\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n                case KeyCodes.arrowRight:\n                    e.preventDefault();\n                    this.suggestionItemIndex = 0;\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n            }\n        }.bind(this));\n\n        this.getModal().on('keydown', SELECTORS.SUGGESTIONS, function(e, data) {\n            switch (e.keyCode) {\n                case KeyCodes.arrowUp:\n                    e.preventDefault();\n                    this.suggestionItemIndex--;\n                    if (this.suggestionItemIndex == -1) {\n                        this.suggestionItemIndex = this.getModal().find(SELECTORS.SUGGESTION_ITEM).length - 1;\n                    }\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n                case KeyCodes.arrowDown:\n                    e.preventDefault();\n                    this.suggestionItemIndex++;\n                    if (this.suggestionItemIndex == this.getModal().find(SELECTORS.SUGGESTION_ITEM).length) {\n                        this.suggestionItemIndex = 0;\n                    }\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n                case KeyCodes.arrowLeft:\n                    e.preventDefault();\n                    this.suggestionItemIndex--;\n                    if (this.suggestionItemIndex == -1) {\n                        this.suggestionItemIndex = this.getModal().find(SELECTORS.SUGGESTION_ITEM).length - 1;\n                    }\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n                case KeyCodes.arrowRight:\n                    e.preventDefault();\n                    this.suggestionItemIndex++;\n                    if (this.suggestionItemIndex == this.getModal().find(SELECTORS.SUGGESTION_ITEM).length) {\n                        this.suggestionItemIndex = 0;\n                    }\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n                case KeyCodes.escape:\n                    e.preventDefault();\n                    this.getModal().find(SELECTORS.SUGGESTIONS).html('');\n                    break;\n            }\n        }.bind(this));\n\n        CustomEvents.define(this.getModal().find(SELECTORS.SUGGESTION_ITEM, [CustomEvents.events.activate]));\n        this.getModal().on(`${CustomEvents.events.activate} ${CustomEvents.events.keyboardActivate}`, SELECTORS.SUGGESTION_ITEM, function() {\n            $(SELECTORS.SEARCH).val($(this).attr('data-value'));\n            $(SELECTORS.SUGGESTIONS).html('');\n        });\n    };\n\n    if (!registered) {\n        ModalRegistry.register(ModalHelp.TYPE, ModalHelp, 'theme_urcourses_default/modal_help');\n        registered = true;\n    }\n\n    return ModalHelp;\n});\n"],"file":"modal_help.min.js"}