{"version":3,"sources":["../src/course_request.js"],"names":["define","$","ajax","notification","str","ModalFactory","ModalEvents","courseActionsLib","_root","_course","_categories","_templatelist","SELECTORS","HEADER","HEADER_TOP","BTN_COURSETOOLS","BTN_DUPLICATE","BTN_NEW","BTN_STUDENT","BTN_DESCRIPTION","_setGlobals","root","course","templatelist","categories","id","coursename","shortname","startdate","enddate","_registerEventListeners","on","_courseAction","_createStudentAction","_editCourseDescription","_element","coursereqAction","category","username","getAttribute","create","type","types","SAVE_CANCEL","title","body","then","modal","setSaveButtonText","getRoot","cancel","save","_createStudentAccount","show","args","courseid","ajaxCall","methodname","success","data","_createdAccount","fail","exception","promise","call","done","response","info","action","created","enrolled","href","attr","window","location","value","origin","substring","lastIndexOf","target","_checkCourseEdit","indexOf","hash","navHeight","outerHeight","animate","scrollTop","offset","top","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Responsible for registering all events for Course Tools including:\n * Course Creation-> calls Course Action Library to handle modals and ajax request\n * Course Duplication-> calls Course Action Library to handle modals and ajax request\n * Create Student Account-> performs ajax request to create a student account for instructor\n * Course Description Edit-> Reroutes to Course Edit page, and add marker to go right to Course Summary Section\n *\n * @package    theme_urcourses_default\n * @author     Brooke Clary\n * \n */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str',\n    'core/modal_factory', 'core/modal_events','theme_urcourses_default/course_actions'], function($, ajax, notification, str, ModalFactory, ModalEvents,courseActionsLib) {\n\n    /** Container jquery object. */\n    var _root;\n    /** Course ID */\n    var _course;\n    var _categories;\n    var _templatelist;\n\n    /** Jquery selector strings. */\n    var SELECTORS = {\n        HEADER: '#page-header .header-body',\n        HEADER_TOP: \"#page-header .page-head\",\n        BTN_COURSETOOLS: '#btn_coursetools',\n        BTN_DUPLICATE: '#btn_duplicate',\n        BTN_NEW: '#btn_new',\n        BTN_STUDENT: '#btn_student',\n        BTN_DESCRIPTION: '#btn_editdescription',\n    };\n\n    /**\n     * Initializes global variables.\n     * @param {string} root - Jquery selector for container.\n     * @param {int} headerstyle - selected header style.\n     * @param {int} courseid - ID of current course.\n     * @return void\n     */\n    var _setGlobals = function(root, course,templatelist, categories) {\n       _root = $(root);\n       _course = course;\n       _templatelist = templatelist;\n       _categories = categories;\n\n       //course constructor, incase any create or duplicate course\n       courseActionsLib = new courseActionsLib(_course.id,_course.coursename, _course.shortname, _course.startdate, _course.enddate, _templatelist, _categories);\n    };\n\n    /**\n     * Sets up event listeners.\n     * @return void\n     */\n    var _registerEventListeners = function() {\n\n        _root.on('click', SELECTORS.BTN_COURSETOOLS, _courseAction);\n        _root.on('click', SELECTORS.BTN_DUPLICATE, _courseAction);\n        _root.on('click', SELECTORS.BTN_NEW, _courseAction);\n        _root.on('click', SELECTORS.BTN_STUDENT, _createStudentAction);\n        _root.on('click', SELECTORS.BTN_DESCRIPTION, _editCourseDescription);\n    };\n\n    /**\n     * If course has been used in previous term, options to\n     * duplicate or create are given. If either duplicate or create are \n     * clicked they are passed to this function, which calls on the \n     * Course Action Library to provide the correct modals, and perform \n     * any ajax requests\n     */\n    var _courseAction = function() {\n\n        var button = \"btn_new\";\n        var _element = $(this);\n\n        courseActionsLib.coursereqAction(_element,button, _course.category, _course.startdate, _course.enddate);\n    }\n\n     /**\n     * Modal after button click to create student account\n     */\n    var _createStudentAction = function() {\n\n        var username =this.getAttribute(\"aria-username\");\n        var modaltitle = 'Create and enroll test student account in course';\n        var modalaction = 'create the test student account '+username+'+student@uregina.ca';\n\t\t\n        //adding in confirmation modal in case buttons accidentally clicked\n        ModalFactory.create({\n            type: ModalFactory.types.SAVE_CANCEL,\n            title: modaltitle,\n            body: \"<p><b>Do you want to \"+ modalaction +\"?</b><br /></p>\"\n        })\n        .then(function(modal) {\n            \n            modal.setSaveButtonText('Create');\n            var root = modal.getRoot();\n            root.on(ModalEvents.cancel, function(){\n                return;\n            });\n\n            root.on(ModalEvents.save, function(){\n                _createStudentAccount(username)\n            });\n\n            modal.show();\n        });\n    };\n\n     /**\n     * After modal info has been entered call ajax request\n     */\n    var _createStudentAccount = function(username) {\n\n        // return if required values aren't set\n        if (!_course.id) {\n            return;\n        }\n\n        // set args\n        var args = {\n            courseid: _course.id,\n            username: username\n        };\n\n        // set ajax call\n        var ajaxCall = {\n            methodname: 'theme_urcourses_default_header_create_test_account',\n            args: args,\n            success: function (data) { \n                _createdAccount(data);\n            },\n            fail: notification.exception\n        };\n\n        // initiate ajax call\n        var promise = ajax.call([ajaxCall]);\n        promise[0].done(function(response) {\n            _createdAccount(response);\n        }).fail(function(ex) {\n            notification.exception;\n        });\t\n    };\n    /**\n     * Handles ajax return and response to return data\n     * @param {Object} response \n     */\n    var _createdAccount = function(data) {\n    \n        //create new modal\n        title = \"Success: \";\n        info=\"\";\n        action=\" Would you like to logout, inorder to login to new account?\";\n\n        //if both actions were done\n        if(data.created != false && data.enrolled !=false){\n            info =data.username+\" was created and enrolled into this course. Login password is the same as current account.\";\n        }else if(data.created != false && data.enrolled ==false ){\n            info = data.username+\" was created, but FAILED to be enrolled into this course\";\n        }else if(data.created == false && data.enrolled !=false ){\n            info = data.username+\" already existed, and has now been enrolled into this course. Login password is the same as current account.\";\n        }else{\n            title = \"ERROR:\"\n            info = data.username+\" already exists and is enrolled into the course\";\n\n            ModalFactory.create({\n                title: title,\n                body: '<p><b>'+info+'</b><br></p>',\n              })\n              .done(function(modal) {\n                modal.show();\n              });\n              \n            return;\n        }\n        \n        //adding in confirmation modal in case buttons accidentally clicked\n        ModalFactory.create({\n            type: ModalFactory.types.SAVE_CANCEL,\n            title: title,\n            body: \"<p><b>\"+ info +\"</b><br>\"+action+\"<br /></p>\"\n        })\n        .then(function(modal) {\n            \n            modal.setSaveButtonText('Logout');\n            var root = modal.getRoot();\n            root.on(ModalEvents.cancel, function(){\n                return;\n            });\n\n            root.on(ModalEvents.save, function(){\n                var href = $('a[data-title=\"logout,moodle\"]').attr('href');\n                window.location.href = href;\n                $(\"#username\").value= data.username;      \n            });\n            modal.show();\n        });\n    };\n\n     /**\n     * Link to course edit page to edit course description\n     */\n    var _editCourseDescription = function() {\n\n        var origin   = window.location.href;    \n        origin =origin.substring(0,origin.lastIndexOf('/'));\n\n        var target = origin + \"/edit.php?id=\"+_course.id+\"#id_descriptionhdr\";\n        window.location.href = target;\n    };\n\n     /**\n     * Check if on course edit page and if hash has been added to url\n     */\n    var _checkCourseEdit = function() {\n\n        var origin   = window.location.href;     \n\n        if (origin.indexOf(\"course/edit.php\") >= 0){\n            if(window.location.hash != \"\"){\n                var navHeight = $('.navbar').outerHeight();\n                $('html, body').animate({\n                    scrollTop: $(window.location.hash).offset().top - navHeight\n                }, 2000);\n            }\n        }\n    };\n\n    /**\n     * Entry point to module. Sets globals and registers event listeners.\n     * @param {String} root Jquery selector for container.\n     * @return void\n     */\n    var init = function(root, course, templatelist, categories) {\n        _setGlobals(root, course, templatelist,categories);\n        _registerEventListeners();\n\n        //little hacky way to use a scroll jump on course edit page without editing course edit\n        _checkCourseEdit();\n    };\n\n    return {\n        init: init\n    };\n\n});"],"file":"course_request.min.js"}