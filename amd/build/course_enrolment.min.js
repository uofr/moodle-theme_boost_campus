function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}f(void 0)})}}define ("theme_urcourses_default/course_enrolment",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","theme_urcourses_default/course_actions"],function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o={HEADER:"#page-header .header-body",HEADER_TOP:"#page-header .page-head",BTN_COURSEENROL:"#btn_courseenrol",BTN_ENROLTERM:".btn_enrolterm",STARTHOLDER:"#course_tools_startholder",ENDHOLDER:"#course_tools_endholder",STARTDAY:"#course_tools_start_day",STARTMONTH:"#course_tools_start_month",STARTYEAR:"#course_tools_start_year",STARTHOUR:"#course_tools_start_hour",STARTMINUTE:"#course_tools_start_minute",ENDDAY:"#course_tools_end_day",ENDMONTH:"#course_tools_end_month",ENDYEAR:"#course_tools_end_year",ENDHOUR:"#course_tools_end_hour",ENDMINUTE:"#course_tools_end_minute",ENDENABLE:"#course_tools_enddate_enabled",ERR_START:"#error_course_tools_start",ERR_END:"#error_course_tools_end"},p={MODAL_COURSE_ACTION_CONTENT:"theme_urcourses_default/modal_course_action_date"},q=function(b,c,d,e,f){h=a(b);i=c;l=d;m=e;n=f;g=new g(i.id,i.coursename,i.shortname,i.startdate,i.enddate,n,m)},r=function(){h.on("click",o.BTN_ENROLTERM,u)},s=function(){a(".tmpl-label").bind("click",function(){v(a(this))})},t=function(){a("#btn_duplicatemodal").bind("click",function(){A(a(this))});a("#btn_newmodal").bind("click",function(){A(a(this))})},u=function(){j=a(this);k=j.attr("id");if(!i.id){return}var d={courseid:i.id,semester:k},e=b.call([{methodname:"theme_urcourses_default_header_enrollment_info",args:d}]);e[0].done(function(a){w(a)}).fail(function(){c.exception})},v=function(b){templateHolder=a("div[data-role=\"templateholder\"");a(templateHolder).find(".active").removeClass("active");b.addClass("active")},w=function(b){var c="Modify enrolment for "+b.semester;activatedlist="";activatedtitle="";isavailable=b.isavaliable;if(!1==isavailable){output="<div class=\"d-flex justify-content-center\"><div id= \"mainspinner\" class=\"spinner-border \" role=\"status\"style=\"display: none;\" ><span class=\"sr-only\">Loading...</span></div></div><div id=\"infoholder\" class=\"\">";output+="<div class=\"alert alert-warning\" role=\"alert\">This course was used in a different semester. Please choose one of the following options:</div>";output+="<button class=\"btn btn-secondary\" id=\"btn_duplicatemodal\" type=\"button\"><i class=\"fa fa-files-o\" aria-hidden=\"true\"></i>Duplicate this course</button>";output+="<button class=\"btn btn-secondary\" id=\"btn_newmodal\"style=\"float: right;\" type=\"button\"><i class=\"fa fa-plus\" aria-hidden=\"true\"></i> Create blank course</button> </div></div>"}else{if(0!=b.activated.length){activatedtitle="<small>The following Banner sections are already enrolled for the selected term:</small>";activatedlist+="<div class=\"list-group\">";a.each(b.activated,function(a,b){activatedlist+="<div class=\"list-group-item list-group-item-secondary\"><h6>"+b.subject+" "+b.course+"-"+b.section+"</h6></div>"});activatedlist+="</div><br>"}templatelist="<div data-role=\"templateholder\" class = \"list-group\" >";if(0!=b.courseinfo.length){if(6<b.courseinfo.length){templatelist+="<label  class=\"col-form-label d-inline \" for=\"bannerselect\">Select Banner Section:</label><br> ";templatelist+="<div class=\"form-control-feedback invalid-feedback\" id=\"error_bannerselect\"></div> ";templatelist+="<select class=\"custom-select\" id=\"bannerselect\" ";a.each(b.courseinfo,function(a,b){templatelist+="<option value = "+b.subject+" "+b.course+"-"+b.section+"</option>"});templatelist+="</select>"}else{count=1;a.each(b.courseinfo,function(a,b){if(1==count){templatelist+="<div data-role = \"bannerselect\" class=\"tmpl-label list-group-item list-group-item-action active\" id = "+b.crn+"><h6>"+b.subject+" "+b.course+"-"+b.section+"</h6></div>"}else{templatelist+="<div data-role = \"bannerselect\" class=\"tmpl-label list-group-item list-group-item-action \" id = "+b.crn+"><h6>"+b.subject+" "+b.course+"-"+b.section+"</h6></div>"}count++})}}else{templatelist+="<div data-role = \"templateselect\" class=\"tmpl-label list-group-item list-group-item-action active\" id = \"0\" ><p>There are no available Banner Sections for this course </p></div>"}templatelist+="</div>"}e.create({type:e.types.SAVE_CANCEL,title:c,body:isavailable?"<p><b>Are you sure you want to modify enrolment for this course?</b><br />"+activatedtitle+activatedlist+"<small>The following CRNs are available for the selected term:</small>"+templatelist+"</p>":output}).then(function(c){if(isavailable){c.setSaveButtonText("Save");var d=c.getRoot();d.on(f.cancel,function(){});d.on(f.save,function(){if(6<b.courseinfo.length){templateid=a("#bannerselect").val()}else{templateHolder=a("div[data-role=\"templateholder\"");selectedTemplate=a(templateHolder).find(".active");templateid=a(selectedTemplate).attr("id")}x(b.courseinfo,templateid)})}else{var d=c.getRoot();d.on(f.cancel,function(){})}d.on(f.hidden,function(){a("div[data-role='templateholder']").remove()});c.show()}).done(function(){if(isavailable){if(6>b.courseinfo.length&&0<b.courseinfo.length){s(j)}}else{t()}})},x=function(){var b=_asyncToGenerator(regeneratorRuntime.mark(function b(c,d){var h,i;return regeneratorRuntime.wrap(function(b){while(1){switch(b.prev=b.next){case 0:h="Change course dates to: ";b.next=3;return self.render(p.MODAL_COURSE_ACTION_CONTENT);case 3:i=b.sent;e.create({type:e.types.SAVE_CANCEL,title:h,body:"<p><b>Confirm Date change?</b><br />"+i}).then(function(b){if(isavailable){b.setSaveButtonText("Save");var e=b.getRoot();e.on(f.cancel,function(){return});e.on(f.save,function(a){if(!y()){a.preventDefault()}else{z(c,d)}})}else{var e=b.getRoot();e.on(f.cancel,function(){return})}e.on(f.hidden,function(){a(o.ENDHOLDER).remove();a(o.STARTHOLDER).remove()});b.show()}).done(function(){var a={year:new Date().getFullYear(),mon:new Date().getMonth(),mday:new Date().getDate()},b={year:new Date().getFullYear()+1,mon:new Date().getMonth(),mday:new Date().getDate()};jQuery.each(l,function(c,d){if(c==k){var e=d.startdate.split("-"),f=d.enddate.split("-");a={year:e[2],mon:e[1],mday:e[0]};b={year:f[2],mon:f[1],mday:f[0]}}});g.populateDateSelects(a,b);g.registerDateEventListeners(j)});case 5:case"end":return b.stop();}}},b)}));return function(){return b.apply(this,arguments)}}(),y=function(){var b=a(o.STARTDAY).val(),c=a(o.STARTMONTH).val(),d=a(o.STARTYEAR).val(),e=a(o.ENDYEAR).val(),f=a(o.ENDDAY).val(),g=a(o.ENDMONTH).val(),h=!0,i=new Date(d+"."+c+"."+b).getTime()/1e3,j=new Date(e+"."+g+"."+f).getTime()/1e3;if(j<i&&a(o.ENDENABLE).is(":checked")){a(o.ERR_START).text("Course end date can not be before start date");a(o.ERR_START).attr("display","block");a(o.ERR_START).show();h=!1}else{a(o.ERR_START).text("");a(o.ERR_END).text("")}return h},z=function(d,f){if(!i.id){return}var g=a(o.STARTDAY).val(),h=a(o.STARTMONTH).val(),j=a(o.STARTYEAR).val(),l=a(o.STARTHOUR).val(),m=a(o.STARTMINUTE).val(),n="0";if(a(o.ENDENABLE).is(":checked")){var p=a(o.ENDDAY).val(),q=a(o.ENDMONTH).val(),r=a(o.ENDYEAR).val(),s=a(o.ENDHOUR).val(),t=a(o.ENDMINUTE).val();n=p+"-"+q+"-"+r+"-"+s+"-"+t}console.log(d);console.log(f);if(0!=f){var u={courseid:i.id,semester:k,crn:f,startdate:g+"-"+h+"-"+j+"-"+l+"-"+m,enddate:n};console.log(u);var v={methodname:"theme_urcourses_default_header_activate_course",args:u,fail:c.exception},w=b.call([v]);w[0].done(function(b){if(""!=b.result){title="Response:";info=b.result}if(b.value){messageHolder=a("#enrollment_span");messageHolder.text("Enrolment: "+b.semester)}e.create({title:title,body:"<p><b>"+info+"</b><br></p>"}).done(function(a){a.show()})}).fail(function(){c.exception})}},A=function(a){var b={year:new Date().getFullYear(),mon:new Date().getMonth(),mday:new Date().getDate()},c={year:new Date().getFullYear()+1,mon:new Date().getMonth(),mday:new Date().getDate()};jQuery.each(l,function(a,d){if(a==k){var e=d.startdate.split("-"),f=d.enddate.split("-");b={year:e[2],mon:e[1],mday:e[0]};c={year:f[2],mon:f[1],mday:f[0]}}});g.coursereqAction(a,"btn_newmodal",i.category,b,c)};return{init:function init(a,b,c,d,e){q(a,b,c,d,e);r()}}});
//# sourceMappingURL=course_enrolment.min.js.map
