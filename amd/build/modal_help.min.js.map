{"version":3,"sources":["../src/modal_help.js"],"names":["SELECTORS","SEARCH","SEARCH_BUTTON","SUGGESTIONS","SUGGESTION_ITEM","SUGGESTION_ITEM_SEL","TEMPLATES","LOADING","MODAL_HELP_CONTENT","MODAL_HELP_TOPICS","ModalHelp","root","courseId","currentUrl","topicList","topicIndex","searchBox","modal","find","searchButton","suggestionBox","getRoot","on","ModalEvents","shown","initContent","searchValue","val","updateSuggestionBox","showSuggestionBox","e","target","hideSuggestionBox","doSearch","keyCode","KeyCodes","enter","getModal","focus","CustomEvents","events","activate","suggestionValue","attr","courseid","currenturl","ModalHelpAjax","getTopicList","getLandingPage","landingPage","renderPromise","Templates","render","html","topic","add","title","setBody","console","error","Notification","exception","filter","suggestions","get","values","Array","isArray","map","suggestion","suggestionMarkup","append","toLowerCase","url","substr","indexOf","getGuidePage","guidePage","removeClass","addClass","Modal","registered","ModalRegistry","register","getType"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Theme Boost Campus - ModalHelp class\n *\n * @package    theme_urcourses_default\n * @author     John Lane\n *\n */\n\nimport $ from 'jquery';\nimport Notification from 'core/notification';\nimport Templates from 'core/templates';\nimport CustomEvents from 'core/custom_interaction_events';\nimport KeyCodes from 'core/key_codes';\nimport Modal from 'core/modal';\nimport ModalEvents from 'core/modal_events';\nimport ModalRegistry from 'core/modal_registry';\nimport ModalHelpAjax from 'theme_urcourses_default/modal_help_ajax';\nimport {FuzzySet} from 'theme_urcourses_default/fuzzyset';\n\nconst SELECTORS = {\n    SEARCH: '#modal_help_search',\n    SEARCH_BUTTON: '#modal_help_search_btn',\n    SUGGESTIONS: '#modal_help_search_suggestions',\n    SUGGESTION_ITEM: '.modal-help-suggestion-item',\n    SUGGESTION_ITEM_SEL: '.modal-help-suggestion-item.selected'\n};\n\nconst TEMPLATES = {\n    LOADING: 'core/loading',\n    MODAL_HELP_CONTENT: 'theme_urcourses_default/modal_help_content',\n    MODAL_HELP_TOPICS: 'theme_urcourses_default/modal_help_topics'\n};\n\nexport default class ModalHelp extends Modal {\n\n    constructor(root) {\n        super(root);\n        this.courseId = null;\n        this.currentUrl = null;\n        this.topicList = null;\n        this.topicIndex = FuzzySet();\n        this.searchBox = this.modal.find(SELECTORS.SEARCH);\n        this.searchButton = this.modal.find(SELECTORS.SEARCH_BUTTON);\n        this.suggestionBox = this.modal.find(SELECTORS.SUGGESTIONS);\n    }\n\n    init(courseId, currentUrl) {\n        this.courseId = courseId;\n        this.currentUrl = currentUrl;\n\n        this.getRoot().on(ModalEvents.shown, () => {\n            this.initContent();\n        });\n        this.searchBox.on('input', () => {\n            const searchValue = this.searchBox.val();\n            this.updateSuggestionBox(searchValue);\n        });\n        this.searchBox.on('focus', () => {\n            const searchValue = this.searchBox.val();\n            this.updateSuggestionBox(searchValue);\n            this.showSuggestionBox();\n        });\n        this.getRoot().on('click', (e) => {\n            if (e.target !== this.searchBox[0] && e.target !== this.suggestionBox[0]) {\n                this.hideSuggestionBox();\n            }\n        });\n        this.searchButton.on('click', () => {\n            this.doSearch();\n        });\n        this.searchBox.on('keydown', (e) => {\n            if (e.keyCode === KeyCodes.enter) {\n                this.getModal().focus();\n                this.hideSuggestionBox();\n                this.doSearch();\n            }\n        });\n        this.suggestionBox.on(CustomEvents.events.activate, SELECTORS.SUGGESTION_ITEM, (e) => {\n            const suggestionValue = $(e.target).attr('data-value');\n            this.searchBox.val(suggestionValue);\n            this.doSearch();\n        });\n    }\n\n    async initContent() {\n        const courseid = this.courseId;\n        const currenturl = this.currentUrl;\n        try {\n            const topicList = await ModalHelpAjax.getTopicList(courseid);\n            const landingPage = await ModalHelpAjax.getLandingPage(courseid, currenturl);\n            const renderPromise = Templates.render(TEMPLATES.MODAL_HELP_CONTENT, {html: landingPage.html});\n\n            this.topicList = topicList;\n            for (const topic of topicList) {\n                this.topicIndex.add(topic.title);\n            }\n            this.setBody(renderPromise);\n        } catch (error) {\n            console.error('error', error);\n            Notification.exception(error);\n        }\n    }\n\n    updateSuggestionBox(filter) {\n        const topicIndex = this.topicIndex;\n        const suggestionBox = this.suggestionBox;\n        let suggestions = topicIndex.get(filter, topicIndex.values(), 0);\n\n        if (Array.isArray(suggestions[0])) {\n            suggestions = suggestions.map(suggestion => suggestion[1]);\n        }\n\n        suggestionBox.html('');\n        for (const suggestion of suggestions) {\n            const suggestionMarkup = `<a href=\"#\"\n                                        class=\"modal-help-suggestion-item\"\n                                        data-value=\"${suggestion}\">\n                                            ${suggestion}\n                                      </a>`;\n            suggestionBox.append(suggestionMarkup);\n        }\n    }\n\n    async doSearch() {\n        const searchValue = this.searchBox.val();\n        const topic = this.topicList.find(topic => topic.title.toLowerCase() === searchValue.toLowerCase());\n        const url = topic.url.substr(topic.url.indexOf('/', 1));\n\n        if (!topic) {\n            return;\n        }\n        try {\n            const guidePage = await ModalHelpAjax.getGuidePage(url);\n            const renderPromise = Templates.render(TEMPLATES.MODAL_HELP_CONTENT, {html: guidePage.html});\n            this.setBody(renderPromise);\n        } catch (error) {\n            Notification.exception(error);\n        }\n    }\n\n    static getType() {\n        return 'theme_urcourses_default-help';\n    }\n\n    showSuggestionBox() {\n        this.suggestionBox.removeClass('d-none');\n    }\n\n    hideSuggestionBox() {\n        this.suggestionBox.addClass('d-none');\n    }\n\n}\n\n// Setup code for adding ModalHelp to the modal factory.\nlet registered = false;\nif (!registered) {\n    ModalRegistry.register(ModalHelp.getType(), ModalHelp, 'theme_urcourses_default/modal_help');\n    registered = true;\n}\n"],"file":"modal_help.min.js"}