define ("theme_urcourses_default/modal_help",["jquery","core/modal","core/modal_registry","core/modal_events","core/key_codes","core/custom_interaction_events","core/notification","core/templates","theme_urcourses_default/modal_help_ajax"],function(a,b,c,d,f,g,h,i,j){var k=!1,l={SEARCH:"#modal_help_search",SEARCH_BUTTON:"#modal_help_search_btn",SUGGESTIONS:"#modal_help_search_suggestions",SUGGESTION_ITEM:".modal-help-suggestion-item",SUGGESTION_ITEM_SEL:".modal-help-suggestion-item.selected"},m={LOADING:"core/loading",MODAL_HELP_CONTENT:"theme_urcourses_default/modal_help_content",MODAL_HELP_TOPICS:"theme_urcourses_default/modal_help_topics"},n=function(a){b.call(this,a);this.searchBox=this.root.find(l.SEARCH);this.searchButton=this.root.find(l.SEARCH_BUTTON);this.suggestionBox=this.root.find(l.SUGGESTIONS);this.topicList=null;this.suggestionIndex=0};n.prototype=Object.create(b.prototype);n.prototype.constructor=n;n.TYPE="theme_urcourses_default-help";n.prototype.selectSuggestion=function(a){this.suggestionBox.find(l.SUGGESTION_ITEM).removeClass("selected");a.addClass("selected")};n.prototype.getSuggestions=function(){return this.suggestionBox.find(l.SUGGESTION_ITEM)};n.prototype.autocomplete=function(a){var b=this,c=a.attr("data-url");c=c.substr(c.indexOf("/",1));this.getModal().focus();this.suggestionBox.addClass("d-none");this.searchBox.val(a.attr("data-value"));j.getGuidePage(c).then(function(a){var c=i.render(m.MODAL_HELP_CONTENT,{html:a.html});b.setBody(c)}).catch(h.exception)};n.prototype.updateSuggestions=function(){var a=this,b=this.searchBox.val(),c=RegExp(b.split("").join(".*"),"i"),d=[],e=!0,f=!1,g=void 0;try{for(var j=this.topicList[Symbol.iterator](),k;!(e=(k=j.next()).done);e=!0){var n=k.value,o=c.exec(n.title);if(o){d.push({title:n.title,url:n.url,length:o[0].length,start:o.index})}}}catch(a){f=!0;g=a}finally{try{if(!e&&null!=j.return){j.return()}}finally{if(f){throw g}}}d.sort(function(c,a){if(c.start<a.start){return-1}if(c.start>a.start){return 1}if(c.length<a.length){return-1}if(c.length>a.length){return 1}});i.render(m.MODAL_HELP_TOPICS,{topics:d}).then(function(b,c){i.replaceNodeContents(l.SUGGESTIONS,b,c);a.selectSuggestion(a.getSuggestions().eq(0))}).catch(h.exception)};n.prototype.registerEventListeners=function(){var c=this;b.prototype.registerEventListeners.call(this);this.getRoot().on(d.shown,function(){j.getRemtlHelp().then(function(a){var b=i.render(m.MODAL_HELP_CONTENT,{html:a.html});return c.setBody(b)}).catch(h.exception);j.getTopicList().then(function(a){c.topicList=a;c.topicList.sort(function(c,a){return c.title.localeCompare(a.title)});return i.render(m.MODAL_HELP_TOPICS,{topics:a})}).then(function(a,b){return i.replaceNodeContents(l.SUGGESTIONS,a,b)}).catch(h.exception)});this.getRoot().on(d.hidden,function(){c.setBody("");c.searchBox.val("");c.suggestionBox.addClass("d-none");i.render(m.LOADING,{}).then(function(a,b){return i.replaceNodeContents(l.SUGGESTIONS,a,b)}).catch(h.exception)});this.getRoot().on("click",function(a){var b=a.target,d=c.searchBox[0],e=c.suggestionBox[0];if(!(b===d)&&!(b===e)){c.suggestionBox.addClass("d-none")}});this.getModal().on("focus",l.SEARCH,function(){c.suggestionBox.removeClass("d-none");c.updateSuggestions();c.selectSuggestion(c.getSuggestions().eq(0))});this.getModal().on("input",l.SEARCH,function(){c.updateSuggestions()});this.getModal().on("keydown",l.SEARCH,function(a){var b=c.getSuggestions();if(a.keyCode===f.arrowDown||a.keyCode===f.arrowRight){a.preventDefault();c.suggestionIndex=1;b.eq(c.suggestionIndex).focus()}else if(a.keyCode===f.arrowUp||a.keyCode===f.arrowLeft){a.preventDefault();c.suggestionIndex=b().length-1;b.eq(c.suggestionIndex).focus()}else if(a.keyCode===f.enter){var d=c.getSuggestions().eq(0);c.autocomplete(d)}});this.getModal().on("keydown",l.SUGGESTION_ITEM,function(a){var b=c.getSuggestions();if(a.keyCode===f.arrowDown||a.keyCode===f.arrowRight){a.preventDefault();c.suggestionIndex++;if(c.suggestionIndex>b.length-1){c.suggestionIndex=0}b.eq(c.suggestionIndex).focus()}else if(a.keyCode===f.arrowUp||a.keyCode===f.arrowLeft){a.preventDefault();c.suggestionIndex--;if(0>c.suggestionIndex){c.suggestionIndex=b.length-1}b.eq(c.suggestionIndex).focus()}});this.getModal().on(g.events.activate,l.SUGGESTION_ITEM,function(b){var d=a(b.target);c.autocomplete(d)});this.getModal().on("mouseover focus",l.SUGGESTION_ITEM,function(b){c.selectSuggestion(a(b.target))})};if(!k){c.register(n.TYPE,n,"theme_urcourses_default/modal_help");k=!0}return n});
//# sourceMappingURL=modal_help.min.js.map
