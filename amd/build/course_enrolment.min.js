function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}f(void 0)})}}define ("theme_urcourses_default/course_enrolment",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","theme_urcourses_default/course_actions"],function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o={HEADER:"#page-header .header-body",HEADER_TOP:"#page-header .page-head",BTN_COURSEENROL:"#btn_courseenrol",BTN_ENROLTERM:".btn_enrolterm",STARTHOLDER:"#course_tools_startholder",ENDHOLDER:"#course_tools_endholder",STARTDAY:"#course_tools_start_day",STARTMONTH:"#course_tools_start_month",STARTYEAR:"#course_tools_start_year",STARTHOUR:"#course_tools_start_hour",STARTMINUTE:"#course_tools_start_minute",ENDDAY:"#course_tools_end_day",ENDMONTH:"#course_tools_end_month",ENDYEAR:"#course_tools_end_year",ENDHOUR:"#course_tools_end_hour",ENDMINUTE:"#course_tools_end_minute",ENDENABLE:"#course_tools_enddate_enabled",ERR_START:"#error_course_tools_start",ERR_END:"#error_course_tools_end"},p={MODAL_COURSE_ACTION_CONTENT:"theme_urcourses_default/modal_course_action_date"},q=function(b,c,d,e,f){h=a(b);i=c;l=d;m=e;n=f;g=new g(i.id,i.coursename,i.shortname,i.startdate,i.enddate,n,m)},r=function(){h.on("click",o.BTN_ENROLTERM,v)},s=function(){a(".tmpl-label").bind("click",function(){w(a(this))})},t=function(){a("#btn_duplicatemodal").bind("click",function(){C(a(this))});a("#btn_newmodal").bind("click",function(){C(a(this))})},u=function(){a("button[data-role=\"delete_button\"]").bind("click",function(){B(a(this))})},v=function(){j=a(this);k=j.attr("id");if(!i.id){return}var d={courseid:i.id,semester:k},e=b.call([{methodname:"theme_urcourses_default_header_enrollment_info",args:d}]);e[0].done(function(a){x(a)}).fail(function(){c.exception})},w=function(b){templateHolder=a("div[data-role=\"templateholder\"");if(b.hasClass("active")){b.removeClass("active");b.find(".fa-check-square-o").addClass("fa-square-o");b.find(".fa-square-o").removeClass("fa-check-square-o")}else{b.addClass("active");b.find(".fa-square-o").addClass("fa-check-square-o");b.find(".fa-check-square-o").removeClass("fa-square-o")}},x=function(b){var c="Modify enrolment for "+b.semester;activatedlist="";activatedtitle="";isavailable=b.isavaliable;if(!1==isavailable){output="<div class=\"d-flex justify-content-center\"><div id= \"mainspinner\" class=\"spinner-border \" role=\"status\"style=\"display: none;\" ><span class=\"sr-only\">Loading...</span></div></div><div id=\"infoholder\" class=\"\">";output+="<div class=\"alert alert-warning\" role=\"alert\">This course was used in a different semester. Please choose one of the following options:</div>";output+="<button class=\"btn btn-secondary\" id=\"btn_duplicatemodal\" type=\"button\"><i class=\"fa fa-files-o\" aria-hidden=\"true\"></i>Duplicate this course</button>";output+="<button class=\"btn btn-secondary\" id=\"btn_newmodal\"style=\"float: right;\" type=\"button\"><i class=\"fa fa-plus\" aria-hidden=\"true\"></i> Create blank course</button> </div></div>"}else{templatelist="<div class=\"form-control-feedback invalid-feedback\" id=\"error_course_tools_section\"></div> <div data-role=\"templateholder\" class = \"list-group\" >";if(0!=b.courseinfo.length){a.each(b.courseinfo,function(a,b){templatelist+="<div data-role = \"bannerselect\" class=\"tmpl-label list-group-item list-group-item-action \" id = "+b.crn+"><h6><i class=\"fa fa-square-o\" aria-hidden=\"true\"></i>  "+b.subject+" "+b.course+"-"+b.section+"</h6></div>"});templatelist+="<br><div class=\"form-check\"><input class=\"form-check-input\" type=\"checkbox\" value=\"\" id=\"course_tools_groups\"><label class=\"form-check-label\" for=\"course_tools_groups\"> Create groups for each section </label> </div>"}else{templatelist+="<div data-role = \"templateselect\" class=\"tmpl-label list-group-item list-group-item-action active\" id = \"0\" ><p>There are no available Banner Sections for this course </p></div>"}if(0!=b.activated.length){activatedtitle="<small>The following Banner sections are already enrolled for the selected term:</small>";activatedlist+="<div class=\"list-group\">";a.each(b.activated,function(a,b){var c="alert-warning";if(b.linked){c="alert-success"}activatedlist+="<div class=\"list-group-item list-group-item-secondary "+c+"\"><button data-role=\"delete_button\" type=\"button\" class=\"btn btn-primary float-right\" id=\"delete_"+b.crn+"_"+b.urid+"\">Delete Enrolment</button><h6>"+b.subject+" "+b.course+"-"+b.section+"<br>enrolled into "+b.fullname+"</h6></div>"});activatedlist+="</div><br>"}templatelist+="</div>"}e.create({type:0!=b.courseinfo.length?e.types.SAVE_CANCEL:e.types.CANCEL,title:c,body:isavailable?"<p><b>Are you sure you want to modify enrolment for this course?</b><br /><small>The following CRNs are available for the selected term:</small>"+templatelist+"</br>"+activatedtitle+activatedlist+"</p>":output}).then(function(c){if(isavailable&&0!=b.courseinfo.length){c.setSaveButtonText("Save");var d=c.getRoot();d.on(f.cancel,function(){});d.on(f.save,function(c){templateHolder=a("div[data-role=\"templateholder\"");selectedTemplates=a(templateHolder).find(".active");if(0>=selectedTemplates.length){c.preventDefault();a("#error_course_tools_section").text("Please select a banner section");a("#error_course_tools_section").attr("display","block");a("#error_course_tools_section").show()}else{for(var d=[],e=0;e<selectedTemplates.length;e++){d.push({crn:a(selectedTemplates[e]).attr("id")})}var f=a("#course_tools_groups").prop("checked");y(b.courseinfo,d,f,b.semester)}})}else{var d=c.getRoot();d.on(f.cancel,function(){})}d.on(f.hidden,function(){a("div[data-role='templateholder']").remove()});c.show()}).done(function(){if(isavailable){if(0<b.courseinfo.length){s(j)}}else{t()}if(0!=b.activated.length){u()}})},y=function(){var b=_asyncToGenerator(regeneratorRuntime.mark(function b(c,d,h){var i,m;return regeneratorRuntime.wrap(function(b){while(1){switch(b.prev=b.next){case 0:i="Change course dates to: ";b.next=3;return self.render(p.MODAL_COURSE_ACTION_CONTENT);case 3:m=b.sent;e.create({type:e.types.SAVE_CANCEL,title:i,body:"<p><b>Confirm Date change?</b><br />"+m}).then(function(b){b.setSaveButtonText("Save");var e=b.getRoot();e.on(f.cancel,function(){return});e.on(f.save,function(a){if(!z()){a.preventDefault()}else{A(c,d,h)}});e.on(f.hidden,function(){a(o.ENDHOLDER).remove();a(o.STARTHOLDER).remove()});b.show()}).done(function(){var a={year:new Date().getFullYear(),mon:new Date().getMonth(),mday:new Date().getDate()},b={year:new Date().getFullYear()+1,mon:new Date().getMonth(),mday:new Date().getDate()};jQuery.each(l,function(c,d){if(c==k){var e=d.startdate.split("-"),f=d.enddate.split("-");a={year:e[2],mon:e[1],mday:e[0]};b={year:f[2],mon:f[1],mday:f[0]}}});g.populateDateSelects(a,b);g.registerDateEventListeners(j)});case 5:case"end":return b.stop();}}},b)}));return function(){return b.apply(this,arguments)}}(),z=function(){var b=a(o.STARTDAY).val(),c=a(o.STARTMONTH).val(),d=a(o.STARTYEAR).val(),e=a(o.ENDYEAR).val(),f=a(o.ENDDAY).val(),g=a(o.ENDMONTH).val(),h=!0,i=new Date(d+"."+c+"."+b).getTime()/1e3,j=new Date(e+"."+g+"."+f).getTime()/1e3;if(j<i&&a(o.ENDENABLE).is(":checked")){a(o.ERR_START).text("Course end date can not be before start date");a(o.ERR_START).attr("display","block");a(o.ERR_START).show();h=!1}else{a(o.ERR_START).text("");a(o.ERR_END).text("")}return h},A=function(d,g,h){if(!i.id){return}var j=a(o.STARTDAY).val(),l=a(o.STARTMONTH).val(),m=a(o.STARTYEAR).val(),n=a(o.STARTHOUR).val(),p=a(o.STARTMINUTE).val(),q="0";if(a(o.ENDENABLE).is(":checked")){var r=a(o.ENDDAY).val(),s=a(o.ENDMONTH).val(),t=a(o.ENDYEAR).val(),u=a(o.ENDHOUR).val(),v=a(o.ENDMINUTE).val();q=r+"-"+s+"-"+t+"-"+u+"-"+v}if(""==h||!1==h){h=0}else{h=1}var w={courseid:i.id,semester:k,crns:g,groupcheck:h,startdate:j+"-"+l+"-"+m+"-"+n+"-"+p,enddate:q},x={methodname:"theme_urcourses_default_header_activate_course",args:w,fail:c.exception},y=b.call([x]);y[0].done(function(b){if(""!=b.result){title="Response:";info=b.result}if(b.value){messageHolder=a("#enrollment_span");messageHolder.text("Enrolment: "+b.semester)}e.create({title:title,body:"<p><b>"+info+"</b><br></p>"}).then(function(b){b.show();var c=b.getRoot();c.on(f.hidden,function(){if(a("#fitem_id_startdate").length){location.reload()}})})}).fail(function(){c.exception})},B=function(d){var f=d.attr("id").split("_"),g={courseid:f[2],semester:k,crn:f[1]},h={methodname:"theme_urcourses_default_header_delete_enrollment",args:g,fail:c.exception},i=b.call([h]);i[0].done(function(b){a("button[data-action=\"cancel\"] ").trigger("click");if(""!=b.result){title="Response:";info=b.result}if(b.value){messageHolder=a("#enrollment_span");messageHolder.text("Enrolment Removal: ")}e.create({title:title,body:"<p><b>"+info+"</b><br></p>"}).done(function(a){a.show()})}).fail(function(){c.exception})},C=function(a){var b={year:new Date().getFullYear(),mon:new Date().getMonth(),mday:new Date().getDate()},c={year:new Date().getFullYear()+1,mon:new Date().getMonth(),mday:new Date().getDate()};jQuery.each(l,function(a,d){if(a==k){var e=d.startdate.split("-"),f=d.enddate.split("-");b={year:e[2],mon:e[1],mday:e[0]};c={year:f[2],mon:f[1],mday:f[0]}}});g.coursereqAction(a,"btn_newmodal",i.category,b,c)};return{init:function init(a,b,c,d,e){q(a,b,c,d,e);r()}}});
//# sourceMappingURL=course_enrolment.min.js.map
