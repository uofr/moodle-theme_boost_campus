{"version":3,"sources":["../src/modal_help.js"],"names":["define","$","Modal","ModalRegistry","ModalEvents","KeyCodes","CustomEvents","Notification","Templates","ModalHelpAjax","registered","SELECTORS","SEARCH","SEARCH_BUTTON","SUGGESTIONS","SUGGESTION_ITEM","TEMPLATES","MODAL_HELP_CONTENT","MODAL_HELP_TOPICS","ModalHelp","root","call","searchBox","find","searchButton","suggestionBox","topicList","prototype","Object","create","constructor","TYPE","registerEventListeners","getRoot","on","shown","getRemtlHelp","then","response","renderPromise","render","html","setBody","catch","exception","getTopicList","topics","js","replaceNodeContents","hidden","val","getModal","removeClass","searchValue","regex","RegExp","split","join","suggestions","length","topic","match","exec","title","push","text","url","start","index","sort","a","b","suggestion","append","events","activate","e","target","attr","getGuidePage","register"],"mappings":"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","sourcesContent":["define(\n[\n    'jquery',\n    'core/modal',\n    'core/modal_registry',\n    'core/modal_events',\n    'core/key_codes',\n    'core/custom_interaction_events',\n    'core/notification',\n    'core/templates',\n    'theme_urcourses_default/modal_help_ajax'\n],\nfunction(\n    $,\n    Modal,\n    ModalRegistry,\n    ModalEvents,\n    KeyCodes,\n    CustomEvents,\n    Notification,\n    Templates,\n    ModalHelpAjax\n) {\n    var registered = false;\n\n    var SELECTORS = {\n        SEARCH: '#modal_help_search',\n        SEARCH_BUTTON: '#modal_help_search_btn',\n        SUGGESTIONS: '#modal_help_search_suggestions',\n        SUGGESTION_ITEM: '.modal-help-suggestion-item',\n    };\n\n    var TEMPLATES = {\n        MODAL_HELP_CONTENT: 'theme_urcourses_default/modal_help_content',\n        MODAL_HELP_TOPICS: 'theme_urcourses_default/modal_help_topics'\n    };\n\n    var CSS = {\n        SUGGESTION_ACTIVE: 'suggestion-active'\n    };\n\n    /**\n     * Modal constructor.\n     *\n     * @param {object} root The root jQuery element for the modal.\n     */\n    var ModalHelp = function(root) {\n        Modal.call(this, root);\n        this.searchBox = this.root.find(SELECTORS.SEARCH);\n        this.searchButton = this.root.find(SELECTORS.SEARCH_BUTTON);\n        this.suggestionBox = this.root.find(SELECTORS.SUGGESTIONS);\n        this.topicList = null;\n    };\n\n    ModalHelp.prototype = Object.create(Modal.prototype);\n    ModalHelp.prototype.constructor = ModalHelp;\n    ModalHelp.TYPE = 'theme_urcourses_default-help';\n\n    /**\n     * Set up event handling.\n     *\n     * @method registerEventListeners\n     */\n    ModalHelp.prototype.registerEventListeners = function() {\n        Modal.prototype.registerEventListeners.call(this);\n\n        this.getRoot().on(ModalEvents.shown, () => {\n            ModalHelpAjax.getRemtlHelp()\n            .then((response) => {\n                var renderPromise = Templates.render(TEMPLATES.MODAL_HELP_CONTENT, {html: response.html});\n                this.setBody(renderPromise);\n            }).catch(Notification.exception);\n            if (this.topicList === null) {\n                ModalHelpAjax.getTopicList()\n                .then((response) => {\n                    this.topicList = response;\n                    return Templates.render(TEMPLATES.MODAL_HELP_TOPICS, {topics: response});\n                })\n                .then((html, js) => {\n                    Templates.replaceNodeContents(SELECTORS.SUGGESTIONS, html, js);\n                }).catch(Notification.exception);\n            }\n        });\n\n        this.getRoot().on(ModalEvents.hidden, () => {\n            this.setBody('');\n            this.searchBox.val('');\n            this.suggestionBox.html('');\n        });\n\n        this.getModal().on('focus', SELECTORS.SEARCH, (e) => {\n            this.suggestionBox.removeClass('d-none');\n        });\n\n        this.getModal().on('input', SELECTORS.SEARCH, (e, data) => {\n            var searchValue = this.searchBox.val();\n            var regex = RegExp(searchValue.split('').join('.*'), 'i');\n            var suggestions = [];\n            this.suggestionBox.html('');\n            if (!searchValue.length) {\n                return;\n            }\n            for (var topic of this.topicList) {\n                var match = regex.exec(topic.title);\n                if (match) {\n                    suggestions.push({\n                        text: topic.title,\n                        url: topic.url,\n                        length: match[0].length,\n                        start: match.index\n                    });\n                }\n            }\n            suggestions.sort((a, b) => {\n                if (a.length < b.length) {\n                    return -1;\n                }\n                if (a.length > b.length) {\n                    return 1;\n                }\n                if (a.start < b.start) {\n                    return -1;\n                }\n                if (a.start > b.start) {\n                    return 1;\n                }\n            });\n            for (var suggestion of suggestions) {\n                var html = `<span class=\"modal-help-suggestion-item\" data-url=\"${suggestion.url}\" data-value=\"${suggestion.text}\">${suggestion.text}</span>`;\n                this.suggestionBox.append(html);\n            }\n        });\n\n        this.getModal().on(CustomEvents.events.activate, SELECTORS.SUGGESTION_ITEM, (e) => {\n            $(SELECTORS.SEARCH).val($(e.target).attr('data-value'));\n            $(SELECTORS.SUGGESTIONS).html('');\n            ModalHelpAjax.getGuidePage($(e.target).attr('data-url'))\n            .then((response) => {\n                var renderPromise = Templates.render(TEMPLATES.MODAL_HELP_CONTENT, {html: response.html});\n                this.setBody(renderPromise);\n            }).catch(Notification.exception);\n        });\n    };\n\n    if (!registered) {\n        ModalRegistry.register(ModalHelp.TYPE, ModalHelp, 'theme_urcourses_default/modal_help');\n        registered = true;\n    }\n\n    return ModalHelp;\n});\n"],"file":"modal_help.min.js"}