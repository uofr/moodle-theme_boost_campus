define(["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","core/fragment","core/yui"],function(a,b,c,d,e,f,g,h){var i,j,k,l,m={UPLOADER:"#course_image_uploader"},n=function(b,c,g,h){i=a(b),j=g,k=h,d.get_string("modal_header","theme_urcourses_default").then(function(b){return e.create({type:e.types.SAVE_CANCEL,title:b,body:o()},a(m.UPLOADER))}).then(function(a){l=a,l.setLarge(),l.getRoot().on(f.hidden,function(){l.setBody(o())}),l.getRoot().on(f.save,p),l.getRoot().on("submit","form",q)})},o=function(a){"undefined"==typeof a&&(a={});var b={jsonformdata:JSON.stringify(a)};return g.loadFragment("theme_urcourses_default","image_form",k,b)},p=function(a){a.preventDefault(),l.getRoot().find("form").submit()},q=function(c){c.preventDefault();var d=document.createEvent("HTMLEvents");d.initEvent("change",!0,!0),l.getRoot().find(":input").each(function(a,b){b.dispatchEvent(d)});var e=a.merge(l.getRoot().find('[aria-invalid="true"]'),l.getRoot().find(".error"));if(e.length)return void e.first().focus();var f=l.getRoot().find("form").serialize();b.call([{methodname:"theme_urcourses_default_upload_course_image",args:{formdata:JSON.stringify(f),courseid:j},done:r,fail:s}])},r=function(a){console.log(a),l.hide()},s=function(a){c.exception(a)};return{init:n}});