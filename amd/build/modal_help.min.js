define ("theme_urcourses_default/modal_help",["exports","jquery","core/notification","core/templates","core/custom_interaction_events","core/key_codes","core/modal","core/modal_events","core/modal_registry","theme_urcourses_default/modal_help_ajax"],function(a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default=void 0;b=k(b);c=k(c);d=k(d);e=k(e);f=k(f);g=k(g);h=k(h);i=k(i);j=k(j);function k(a){return a&&a.__esModule?a:{default:a}}function l(a){if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){l=function(a){return typeof a}}else{l=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return l(a)}function m(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function n(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){m(h,d,e,f,g,"next",a)}function g(a){m(h,d,e,f,g,"throw",a)}f(void 0)})}}function o(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function p(a,b){for(var c=0,d;c<b.length;c++){d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;if("value"in d)d.writable=!0;Object.defineProperty(a,d.key,d)}}function q(a,b,c){if(b)p(a.prototype,b);if(c)p(a,c);return a}function r(a,b){if(b&&("object"===l(b)||"function"==typeof b)){return b}return s(a)}function s(a){if(void 0===a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return a}function t(a){t=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)};return t(a)}function u(a,b){if("function"!=typeof b&&null!==b){throw new TypeError("Super expression must either be null or a function")}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}});if(b)v(a,b)}function v(a,b){v=Object.setPrototypeOf||function(a,b){a.__proto__=b;return a};return v(a,b)}var w={SEARCH:"#modal_help_search",SEARCH_BUTTON:"#modal_help_search_btn",SUGGESTIONS:"#modal_help_search_suggestions",SUGGESTION_ITEM:".modal-help-suggestion-item",SUGGESTION_ITEM_SEL:".modal-help-suggestion-item.selected"},x={LOADING:"core/loading",MODAL_HELP_CONTENT:"theme_urcourses_default/modal_help_content",MODAL_HELP_TOPICS:"theme_urcourses_default/modal_help_topics"},y=function(a){u(g,a);function g(a){var b;o(this,g);b=r(this,t(g).call(this,a));b.courseId=null;b.currentUrl=null;b.topicList=null;b.searchBox=b.modal.find(w.SEARCH);b.searchButton=b.modal.find(w.SEARCH_BUTTON);b.suggestionBox=b.modal.find(w.SUGGESTIONS);return b}q(g,[{key:"init",value:function init(a,c){var d=this;this.setCourseId(a);this.setCurrentUrl(c);this.getRoot().on(h.default.shown,function(){d.initContent()});this.getSearchBox().on("input",function(){var a=d.getSearchBox().val();d.updateSuggestionBox(d.topicList,a)});this.getSearchBox().on("focus",function(){var a=d.getSearchBox().val();d.updateSuggestionBox(d.topicList,a);d.showSuggestionBox()});this.getRoot().on("click",function(a){if(a.target!==d.getSearchBox()[0]&&a.target!==d.getSuggestionBox()[0]){d.hideSuggestionBox()}});this.getSearchButton().on("click",function(){d.doSearch()});this.getSearchBox().on("keydown",function(a){if(a.keyCode===f.default.enter){d.getModal().focus();d.hideSuggestionBox();d.doSearch()}});this.getSuggestionBox().on(e.default.events.activate,w.SUGGESTION_ITEM,function(a){var c=(0,b.default)(a.target).attr("data-value");d.getSearchBox().val(c);d.doSearch()})}},{key:"initContent",value:function(){var a=n(regeneratorRuntime.mark(function a(){var b,e,f,g,h,i;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:b=this.getCourseId();e=this.getCurrentUrl();a.prev=2;a.next=5;return j.default.getTopicList(b);case 5:f=a.sent;a.next=8;return j.default.getLandingPage(b,e);case 8:g=a.sent;h=d.default.render(x.MODAL_HELP_CONTENT,{html:g.html});i=this.getSearchBox().val();this.setTopicList(f);this.updateSuggestionBox(f,i);this.setBody(h);a.next=20;break;case 16:a.prev=16;a.t0=a["catch"](2);console.error("error",a.t0);c.default.exception(a.t0);case 20:case"end":return a.stop();}}},a,this,[[2,16]])}));return function initContent(){return a.apply(this,arguments)}}()},{key:"doSearch",value:function(){var a=n(regeneratorRuntime.mark(function a(){var b,e,f,g,h;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:b=this.getSearchBox().val();e=this.topicList.find(function(a){return a.title.toLowerCase()===b.toLowerCase()});f=e.url.substr(e.url.indexOf("/",1));if(e){a.next=5;break}return a.abrupt("return");case 5:a.prev=5;a.next=8;return j.default.getGuidePage(f);case 8:g=a.sent;h=d.default.render(x.MODAL_HELP_CONTENT,{html:g.html});this.setBody(h);a.next=16;break;case 13:a.prev=13;a.t0=a["catch"](5);c.default.exception(a.t0);case 16:case"end":return a.stop();}}},a,this,[[5,13]])}));return function doSearch(){return a.apply(this,arguments)}}()},{key:"setCourseId",value:function setCourseId(a){this.courseId=a}},{key:"getCourseId",value:function getCourseId(){return this.courseId}},{key:"setCurrentUrl",value:function setCurrentUrl(a){this.currentUrl=a}},{key:"getCurrentUrl",value:function getCurrentUrl(){return this.currentUrl}},{key:"setTopicList",value:function setTopicList(a){this.topicList=a}},{key:"getTopicList",value:function getTopicList(){return this.topicList}},{key:"getSearchBox",value:function getSearchBox(){return this.searchBox}},{key:"getSearchButton",value:function getSearchButton(){return this.searchButton}},{key:"getSuggestionBox",value:function getSuggestionBox(){return this.suggestionBox}},{key:"setSuggestionBox",value:function setSuggestionBox(a){var b=this.getSuggestionBox();b.html("");var c=!0,d=!1,e=void 0;try{for(var f=a[Symbol.iterator](),g;!(c=(g=f.next()).done);c=!0){var h=g.value,i="<a href=\"#\"\n                                        class=\"modal-help-suggestion-item\"\n                                        data-url=\"".concat(h.url,"\"\n                                        data-value=\"").concat(h.title,"\">\n                                            ").concat(h.title,"\n                                      </a>");b.append(i)}}catch(a){d=!0;e=a}finally{try{if(!c&&null!=f.return){f.return()}}finally{if(d){throw e}}}}},{key:"updateSuggestionBox",value:function updateSuggestionBox(a,b){var c=this.generateSuggestions(a,b);this.setSuggestionBox(c)}},{key:"generateSuggestions",value:function generateSuggestions(a,b){var c=RegExp(b.split("").join(".*"),"i"),d=[],e=!0,f=!1,g=void 0;try{for(var h=a[Symbol.iterator](),i;!(e=(i=h.next()).done);e=!0){var j=i.value,k=c.exec(j.title);if(k){d.push({title:j.title,url:j.url,length:k[0].length,start:k.index})}}}catch(a){f=!0;g=a}finally{try{if(!e&&null!=h.return){h.return()}}finally{if(f){throw g}}}d.sort(function(c,a){if(c.start<a.start){return-1}if(c.start>a.start){return 1}if(c.length<a.length){return-1}if(c.length>a.length){return 1}});return d}},{key:"showSuggestionBox",value:function showSuggestionBox(){this.getSuggestionBox().removeClass("d-none")}},{key:"hideSuggestionBox",value:function hideSuggestionBox(){this.getSuggestionBox().addClass("d-none")}}],[{key:"getType",value:function getType(){return"theme_urcourses_default-help"}}]);return g}(g.default);a.default=y;var z=!1;if(!z){i.default.register(y.getType(),y,"theme_urcourses_default/modal_help");z=!0}return a.default});
//# sourceMappingURL=modal_help.min.js.map
