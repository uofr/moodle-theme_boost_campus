{"version":3,"sources":["../src/modal_help.js"],"names":["define","$","Modal","ModalRegistry","ModalEvents","KeyCodes","CustomEvents","Notification","Templates","ModalHelpAjax","registered","SELECTORS","SEARCH","SEARCH_BUTTON","SUGGESTIONS","SUGGESTION_ITEM","LOADING_OVERLAY","TEMPLATES","MODAL_HELP_CONTENT","CSS","SUGGESTION_ACTIVE","ModalHelp","root","call","searchBox","find","searchButton","suggestionBox","suggestionItemIndex","topicsList","prototype","Object","create","constructor","TYPE","getNextSuggestion","getModal","removeClass","length","eq","addClass","getPrevSuggestion","registerEventListeners","getRoot","on","shown","getRemtlHelp","then","response","renderPromise","render","html","setBody","catch","exception","getTopicList","hidden","val","searchValue","regex","RegExp","split","join","suggestions","topic","match","exec","title","push","text","start","index","sort","a","b","suggestion","append","e","keyCode","arrowUp","arrowLeft","preventDefault","arrowDown","arrowRight","escape","events","activate","keyboardActivate","attr","register"],"mappings":"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","sourcesContent":["define(\n[\n    'jquery',\n    'core/modal',\n    'core/modal_registry',\n    'core/modal_events',\n    'core/key_codes',\n    'core/custom_interaction_events',\n    'core/notification',\n    'core/templates',\n    'theme_urcourses_default/modal_help_ajax'\n],\nfunction(\n    $,\n    Modal,\n    ModalRegistry,\n    ModalEvents,\n    KeyCodes,\n    CustomEvents,\n    Notification,\n    Templates,\n    ModalHelpAjax\n) {\n    var registered = false;\n\n    var SELECTORS = {\n        SEARCH: '#modal_help_search',\n        SEARCH_BUTTON: '#modal_help_search_btn',\n        SUGGESTIONS: '#modal_help_search_suggestions',\n        SUGGESTION_ITEM: '.modal-help-suggestion-item',\n        LOADING_OVERLAY: '[data-region=\"overlay-icon-container\"]'\n    };\n\n    var TEMPLATES = {\n        MODAL_HELP_CONTENT: 'theme_urcourses_default/modal_help_content'\n    };\n\n    var CSS = {\n        SUGGESTION_ACTIVE: 'suggestion-active'\n    };\n\n    /**\n     * Modal constructor.\n     *\n     * @param {object} root The root jQuery element for the modal.\n     */\n    var ModalHelp = function(root) {\n        Modal.call(this, root);\n        this.searchBox = this.root.find(SELECTORS.SEARCH);\n        this.searchButton = this.root.find(SELECTORS.SEARCH_BUTTON);\n        this.suggestionBox = this.root.find(SELECTORS.SUGGESTIONS);\n        this.suggestionItemIndex = -1;\n        this.topicsList = null;\n    };\n\n    ModalHelp.prototype = Object.create(Modal.prototype);\n    ModalHelp.prototype.constructor = ModalHelp;\n    ModalHelp.TYPE = 'theme_urcourses_default-help';\n\n    ModalHelp.prototype.getNextSuggestion = function() {\n        this.getModal().find(SELECTORS.SUGGESTION_ITEM).removeClass(CSS.SUGGESTION_ACTIVE);\n        this.suggestionItemIndex++;\n        if (this.suggestionItemIndex > this.getModal().find(SELECTORS.SUGGESTION_ITEM).length - 1) {\n            this.suggestionItemIndex = 0;\n        }\n        this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).addClass(CSS.SUGGESTION_ACTIVE);\n    };\n\n    ModalHelp.prototype.getPrevSuggestion = function() {\n        this.getModal().find(SELECTORS.SUGGESTION_ITEM).removeClass(CSS.SUGGESTION_ACTIVE);\n        this.suggestionItemIndex--;\n        if (this.suggestionItemIndex < 0) {\n            this.suggestionItemIndex = this.getModal().find(SELECTORS.SUGGESTION_ITEM).length - 1;\n        }\n        this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).addClass(CSS.SUGGESTION_ACTIVE);\n    };\n\n    /**\n     * Set up event handling.\n     *\n     * @method registerEventListeners\n     */\n    ModalHelp.prototype.registerEventListeners = function() {\n        Modal.prototype.registerEventListeners.call(this);\n\n        this.getRoot().on(ModalEvents.shown, () => {\n            // get default content\n            ModalHelpAjax.getRemtlHelp()\n            .then((response) => {\n                var renderPromise = Templates.render(TEMPLATES.MODAL_HELP_CONTENT, {html: response.html});\n                this.setBody(renderPromise);\n            }).catch(Notification.exception);\n            // if topic list is null, get the list\n            // otherwise, it's been set already and we don't need to do an ajax request\n            if (this.topicsList === null) {\n                ModalHelpAjax.getTopicList()\n                .then((response) => {\n                    this.topicsList = response;\n                });\n            }\n        });\n\n        this.getRoot().on(ModalEvents.hidden, () => {\n            this.setBody('');\n            this.searchBox.val('');\n            this.suggestionBox.html('');\n        });\n\n        this.getModal().on('input', SELECTORS.SEARCH, (e, data) => {\n            // this function should do nothing until the list is loaded\n            if (this.topicsList === null) {\n                return;\n            }\n            var searchValue = this.searchBox.val();\n            var regex = RegExp(searchValue.split('').join('.*'), 'i');\n            var suggestions = [];\n            this.suggestionBox.html('');\n            if (!searchValue.length) {\n                return;\n            }\n            for (var topic of this.topicsList) {\n                var match = regex.exec(topic.title);\n                if (match) {\n                    suggestions.push({\n                        text: topic.title,\n                        length: match[0].length,\n                        start: match.index\n                    });\n                }\n            }\n            suggestions.sort((a, b) => {\n                if (a.length < b.length) {\n                    return -1;\n                }\n                if (a.length > b.length) {\n                    return 1;\n                }\n                if (a.start < b.start) {\n                    return -1;\n                }\n                if (a.start > b.start) {\n                    return 1;\n                }\n            });\n            for (var suggestion of suggestions) {\n                var html = `<span class=\"modal-help-suggestion-item\" data-value=\"${suggestion.text}\">${suggestion.text}</span>`;\n                this.suggestionBox.append(html);\n            }\n        });\n\n        this.getModal().on('keydown', SELECTORS.SEARCH, (e, data) => {\n            if (e.keyCode === KeyCodes.arrowUp || e.keyCode === KeyCodes.arrowLeft) {\n                e.preventDefault();\n                this.getPrevSuggestion();\n            }\n            else if (e.keyCode === KeyCodes.arrowDown || e.keyCode === KeyCodes.arrowRight) {\n                e.preventDefault();\n                this.getNextSuggestion();\n            }\n        });\n\n        this.getModal().on('keydown', SELECTORS.SUGGESTIONS, (e, data) => {\n            if (e.keyCode === KeyCodes.arrowUp || e.keyCode === KeyCodes.arrowLeft) {\n                e.preventDefault();\n                this.getPrevSuggestion();\n            }\n            else if (e.keyCode === KeyCodes.arrowDown || e.keyCode === KeyCodes.arrowRight) {\n                e.preventDefault();\n                this.getNextSuggestion();\n            }\n            else if (e.keyCode === KeyCodes.escape) {\n                e.preventDefault();\n                this.getModal().find(SELECTORS.SUGGESTIONS).html('');\n            }\n        });\n\n        CustomEvents.define(this.getModal().find(SELECTORS.SUGGESTION_ITEM, [CustomEvents.events.activate]));\n        this.getModal().on(`${CustomEvents.events.activate} ${CustomEvents.events.keyboardActivate}`, SELECTORS.SUGGESTION_ITEM, function() {\n            $(SELECTORS.SEARCH).val($(this).attr('data-value'));\n            $(SELECTORS.SUGGESTIONS).html('');\n        });\n\n        this.getModal().on('mouseover', SELECTORS.SUGGESTIONS, () => {\n            this.suggestionItemIndex = -1;\n            this.getModal().find(SELECTORS.SUGGESTION_ITEM).removeClass(CSS.SUGGESTION_ACTIVE);\n        });\n    };\n\n    if (!registered) {\n        ModalRegistry.register(ModalHelp.TYPE, ModalHelp, 'theme_urcourses_default/modal_help');\n        registered = true;\n    }\n\n    return ModalHelp;\n});\n"],"file":"modal_help.min.js"}