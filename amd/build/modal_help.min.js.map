{"version":3,"sources":["../src/modal_help.js"],"names":["define","$","Modal","ModalRegistry","ModalEvents","KeyCodes","CustomEvents","Notification","Templates","ModalHelpAjax","registered","SELECTORS","SEARCH","SEARCH_BUTTON","SUGGESTIONS","SUGGESTION_ITEM","LOADING_OVERLAY","TEMPLATES","MODAL_HELP_CONTENT","ModalHelp","root","call","searchBox","find","searchButton","suggestionBox","suggestionItemIndex","topicsList","prototype","Object","create","constructor","TYPE","registerEventListeners","getRoot","on","shown","getRemtlHelp","then","response","renderPromise","render","html","setBody","catch","exception","getTopicList","hidden","val","getModal","searchValue","regex","RegExp","split","join","suggestions","length","topic","match","exec","title","push","text","start","index","sort","a","b","suggestion","append","e","keyCode","arrowUp","preventDefault","eq","focus","arrowDown","arrowLeft","arrowRight","bind","escape","events","activate","keyboardActivate","attr","register"],"mappings":"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","sourcesContent":["define(\n[\n    'jquery',\n    'core/modal',\n    'core/modal_registry',\n    'core/modal_events',\n    'core/key_codes',\n    'core/custom_interaction_events',\n    'core/notification',\n    'core/templates',\n    'theme_urcourses_default/modal_help_ajax'\n],\nfunction(\n    $,\n    Modal,\n    ModalRegistry,\n    ModalEvents,\n    KeyCodes,\n    CustomEvents,\n    Notification,\n    Templates,\n    ModalHelpAjax\n) {\n    var registered = false;\n\n    var SELECTORS = {\n        SEARCH: '#modal_help_search',\n        SEARCH_BUTTON: '#modal_help_search_btn',\n        SUGGESTIONS: '#modal_help_search_suggestions',\n        SUGGESTION_ITEM: '.suggestion-item',\n        LOADING_OVERLAY: '[data-region=\"overlay-icon-container\"]'\n    };\n\n    var TEMPLATES = {\n        MODAL_HELP_CONTENT: 'theme_urcourses_default/modal_help_content'\n    };\n\n    /**\n     * Modal constructor.\n     *\n     * @param {object} root The root jQuery element for the modal.\n     */\n    var ModalHelp = function(root) {\n        Modal.call(this, root);\n        this.searchBox = this.root.find(SELECTORS.SEARCH);\n        this.searchButton = this.root.find(SELECTORS.SEARCH_BUTTON);\n        this.suggestionBox = this.root.find(SELECTORS.SUGGESTIONS);\n        this.suggestionItemIndex = 0;\n        this.topicsList = null;\n    };\n\n    ModalHelp.prototype = Object.create(Modal.prototype);\n    ModalHelp.prototype.constructor = ModalHelp;\n    ModalHelp.TYPE = 'theme_urcourses_default-help';\n\n    /**\n     * Set up event handling.\n     *\n     * @method registerEventListeners\n     */\n    ModalHelp.prototype.registerEventListeners = function() {\n        Modal.prototype.registerEventListeners.call(this);\n\n        this.getRoot().on(ModalEvents.shown, () => {\n            // get default content\n            ModalHelpAjax.getRemtlHelp()\n            .then((response) => {\n                var renderPromise = Templates.render(TEMPLATES.MODAL_HELP_CONTENT, {html: response.html});\n                this.setBody(renderPromise);\n            }).catch(Notification.exception);\n            // if topic list is null, get the list\n            // otherwise, it's been set already and we don't need to do an ajax request\n            if (this.topicsList === null) {\n                ModalHelpAjax.getTopicList()\n                .then((response) => {\n                    this.topicsList = response;\n                });\n            }\n        });\n\n        this.getRoot().on(ModalEvents.hidden, () => {\n            this.setBody('');\n            this.searchBox.val('');\n            this.suggestionBox.html('');\n        });\n\n        this.getModal().on('input', SELECTORS.SEARCH, (e, data) => {\n            // this function should do nothing until the list is loaded\n            if (this.topicsList === null) {\n                return;\n            }\n            var searchValue = this.searchBox.val();\n            var regex = RegExp(searchValue.split('').join('.*'), 'i');\n            var suggestions = [];\n            this.suggestionBox.html('');\n            if (!searchValue.length) {\n                return;\n            }\n            for (var topic of this.topicsList) {\n                var match = regex.exec(topic.title);\n                if (match) {\n                    suggestions.push({\n                        text: topic.title,\n                        length: match[0].length,\n                        start: match.index\n                    });\n                }\n            }\n            suggestions.sort(function(a, b) {\n                if (a.length < b.length) {\n                    return -1;\n                }\n                if (a.length > b.length) {\n                    return 1;\n                }\n                if (a.start < b.start) {\n                    return -1;\n                }\n                if (a.start > b.start) {\n                    return 1;\n                }\n            });\n            for (var suggestion of suggestions) {\n                var html = `<a href=\"#\" class=\"modal-help-suggestion-item\" data-value=\"${suggestion.text}\">${suggestion.text}</a>`;\n                this.suggestionBox.append(html);\n            }\n        });\n\n        this.getModal().on('keydown', SELECTORS.SEARCH, function(e, data) {\n            switch (e.keyCode) {\n                case KeyCodes.arrowUp:\n                    e.preventDefault();\n                    this.suggestionItemIndex = this.getModal().find(SELECTORS.SUGGESTION_ITEM).length - 1;\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n                case KeyCodes.arrowDown:\n                    e.preventDefault();\n                    this.suggestionItemIndex = 0;\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n                case KeyCodes.arrowLeft:\n                     e.preventDefault();\n                    this.suggestionItemIndex = this.getModal().find(SELECTORS.SUGGESTION_ITEM).length - 1;\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n                case KeyCodes.arrowRight:\n                    e.preventDefault();\n                    this.suggestionItemIndex = 0;\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n            }\n        }.bind(this));\n\n        this.getModal().on('keydown', SELECTORS.SUGGESTIONS, function(e, data) {\n            switch (e.keyCode) {\n                case KeyCodes.arrowUp:\n                    e.preventDefault();\n                    this.suggestionItemIndex--;\n                    if (this.suggestionItemIndex == -1) {\n                        this.suggestionItemIndex = this.getModal().find(SELECTORS.SUGGESTION_ITEM).length - 1;\n                    }\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n                case KeyCodes.arrowDown:\n                    e.preventDefault();\n                    this.suggestionItemIndex++;\n                    if (this.suggestionItemIndex == this.getModal().find(SELECTORS.SUGGESTION_ITEM).length) {\n                        this.suggestionItemIndex = 0;\n                    }\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n                case KeyCodes.arrowLeft:\n                    e.preventDefault();\n                    this.suggestionItemIndex--;\n                    if (this.suggestionItemIndex == -1) {\n                        this.suggestionItemIndex = this.getModal().find(SELECTORS.SUGGESTION_ITEM).length - 1;\n                    }\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n                case KeyCodes.arrowRight:\n                    e.preventDefault();\n                    this.suggestionItemIndex++;\n                    if (this.suggestionItemIndex == this.getModal().find(SELECTORS.SUGGESTION_ITEM).length) {\n                        this.suggestionItemIndex = 0;\n                    }\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n                case KeyCodes.escape:\n                    e.preventDefault();\n                    this.getModal().find(SELECTORS.SUGGESTIONS).html('');\n                    break;\n            }\n        }.bind(this));\n\n        CustomEvents.define(this.getModal().find(SELECTORS.SUGGESTION_ITEM, [CustomEvents.events.activate]));\n        this.getModal().on(`${CustomEvents.events.activate} ${CustomEvents.events.keyboardActivate}`, SELECTORS.SUGGESTION_ITEM, function() {\n            $(SELECTORS.SEARCH).val($(this).attr('data-value'));\n            $(SELECTORS.SUGGESTIONS).html('');\n        });\n    };\n\n    if (!registered) {\n        ModalRegistry.register(ModalHelp.TYPE, ModalHelp, 'theme_urcourses_default/modal_help');\n        registered = true;\n    }\n\n    return ModalHelp;\n});\n"],"file":"modal_help.min.js"}