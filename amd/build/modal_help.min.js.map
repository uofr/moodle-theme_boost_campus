{"version":3,"sources":["../src/modal_help.js"],"names":["define","$","Modal","ModalRegistry","ModalEvents","KeyCodes","CustomEvents","Notification","Templates","ModalHelpAjax","registered","SELECTORS","SEARCH","SEARCH_BUTTON","SUGGESTIONS","SUGGESTION_ITEM","TEMPLATES","MODAL_HELP_CONTENT","ModalHelp","root","call","searchBox","find","searchButton","suggestionBox","suggestionItemIndex","prototype","Object","create","constructor","TYPE","registerEventListeners","getRoot","on","shown","promises","getModalContent","then","response","renderPromise","render","html","setBody","catch","exception","topicsList","hidden","getModal","searchValue","val","regex","RegExp","split","join","suggestions","length","topic","match","exec","title","push","text","start","index","sort","a","b","suggestion","append","e","keyCode","arrowUp","preventDefault","eq","focus","arrowDown","arrowLeft","arrowRight","bind","escape","events","activate","keyboardActivate","attr","register"],"mappings":"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","sourcesContent":["define(\n[\n    'jquery',\n    'core/modal',\n    'core/modal_registry',\n    'core/modal_events',\n    'core/key_codes',\n    'core/custom_interaction_events',\n    'core/notification',\n    'core/templates',\n    'theme_urcourses_default/modal_help_ajax'\n],\nfunction(\n    $,\n    Modal,\n    ModalRegistry,\n    ModalEvents,\n    KeyCodes,\n    CustomEvents,\n    Notification,\n    Templates,\n    ModalHelpAjax\n) {\n    var registered = false;\n\n    var SELECTORS = {\n        SEARCH: '#modal_help_search',\n        SEARCH_BUTTON: '#modal_help_search_btn',\n        SUGGESTIONS: '#modal_help_search_suggestions',\n        SUGGESTION_ITEM: '.suggestion-item'\n    };\n\n    var TEMPLATES = {\n        MODAL_HELP_CONTENT: 'theme_urcourses_default/modal_help_content'\n    };\n\n    /**\n     * Modal constructor.\n     *\n     * @param {object} root The root jQuery element for the modal.\n     */\n    var ModalHelp = function(root) {\n        Modal.call(this, root);\n        this.searchBox = this.root.find(SELECTORS.SEARCH);\n        this.searchButton = this.root.find(SELECTORS.SEARCH_BUTTON);\n        this.suggestionBox = this.root.find(SELECTORS.SUGGESTIONS);\n        this.suggestionItemIndex = 0;\n    };\n\n    ModalHelp.prototype = Object.create(Modal.prototype);\n    ModalHelp.prototype.constructor = ModalHelp;\n    ModalHelp.TYPE = 'theme_urcourses_default-help';\n\n    /**\n     * Set up event handling.\n     *\n     * @method registerEventListeners\n     */\n    ModalHelp.prototype.registerEventListeners = function() {\n        Modal.prototype.registerEventListeners.call(this);\n\n        this.getRoot().on(ModalEvents.shown, () => {\n\t\t\tvar promises = ModalHelpAjax.getModalContent();\n\t\t\tpromises[0].then((response) => {\n                var renderPromise = Templates.render(TEMPLATES.MODAL_HELP_CONTENT, {html: response.html});\n                this.setBody(renderPromise);\n            }).catch(Notification.exception);\n            promises[1].then((response) => {\n                this.topicsList = response;\n            }).catch(Notification.exception);\n        });\n\n        this.getRoot().on(ModalEvents.hidden, () => {\n            this.setBody('');\n        });\n\n        this.getModal().on('input', SELECTORS.SEARCH, (e, data) => {\n            var searchValue = this.searchBox.val();\n            var regex = RegExp(searchValue.split('').join('.*'), 'i');\n            var suggestions = [];\n            this.suggestionBox.html('');\n            if (!searchValue.length) {\n                return;\n            }\n            for (var topic of this.topicsList) {\n                var match = regex.exec(topic.title);\n                if (match) {\n                    suggestions.push({\n                        text: topic.title,\n                        length: match[0].length,\n                        start: match.index\n                    });\n                }\n            }\n            suggestions.sort(function(a, b) {\n                if (a.length < b.length) {\n                    return -1;\n                }\n                if (a.length > b.length) {\n                    return 1;\n                }\n                if (a.start < b.start) {\n                    return -1;\n                }\n                if (a.start > b.start) {\n                    return 1;\n                }\n            });\n            for (var suggestion of suggestions) {\n                var html = `<a href=\"#\" class=\"dropdown-item suggestion-item\" data-value=\"${suggestion.text}\">${suggestion.text}</a>`;\n                this.suggestionBox.append(html);\n            }\n        });\n\n        this.getModal().on('keydown', SELECTORS.SEARCH, function(e, data) {\n            switch (e.keyCode) {\n                case KeyCodes.arrowUp:\n                    e.preventDefault();\n                    this.suggestionItemIndex = this.getModal().find(SELECTORS.SUGGESTION_ITEM).length - 1;\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n                case KeyCodes.arrowDown:\n                    e.preventDefault();\n                    this.suggestionItemIndex = 0;\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n                case KeyCodes.arrowLeft:\n                     e.preventDefault();\n                    this.suggestionItemIndex = this.getModal().find(SELECTORS.SUGGESTION_ITEM).length - 1;\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n                case KeyCodes.arrowRight:\n                    e.preventDefault();\n                    this.suggestionItemIndex = 0;\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n            }\n        }.bind(this));\n\n        this.getModal().on('keydown', SELECTORS.SUGGESTIONS, function(e, data) {\n            switch (e.keyCode) {\n                case KeyCodes.arrowUp:\n                    e.preventDefault();\n                    this.suggestionItemIndex--;\n                    if (this.suggestionItemIndex == -1) {\n                        this.suggestionItemIndex = this.getModal().find(SELECTORS.SUGGESTION_ITEM).length - 1;\n                    }\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n                case KeyCodes.arrowDown:\n                    e.preventDefault();\n                    this.suggestionItemIndex++;\n                    if (this.suggestionItemIndex == this.getModal().find(SELECTORS.SUGGESTION_ITEM).length) {\n                        this.suggestionItemIndex = 0;\n                    }\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n                case KeyCodes.arrowLeft:\n                    e.preventDefault();\n                    this.suggestionItemIndex--;\n                    if (this.suggestionItemIndex == -1) {\n                        this.suggestionItemIndex = this.getModal().find(SELECTORS.SUGGESTION_ITEM).length - 1;\n                    }\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n                case KeyCodes.arrowRight:\n                    e.preventDefault();\n                    this.suggestionItemIndex++;\n                    if (this.suggestionItemIndex == this.getModal().find(SELECTORS.SUGGESTION_ITEM).length) {\n                        this.suggestionItemIndex = 0;\n                    }\n                    this.getModal().find(SELECTORS.SUGGESTION_ITEM).eq(this.suggestionItemIndex).focus();\n                    break;\n                case KeyCodes.escape:\n                    e.preventDefault();\n                    this.getModal().find(SELECTORS.SUGGESTIONS).html('');\n                    break;\n            }\n        }.bind(this));\n\n        CustomEvents.define(this.getModal().find(SELECTORS.SUGGESTION_ITEM, [CustomEvents.events.activate]));\n        this.getModal().on(`${CustomEvents.events.activate} ${CustomEvents.events.keyboardActivate}`, SELECTORS.SUGGESTION_ITEM, function() {\n            $(SELECTORS.SEARCH).val($(this).attr('data-value'));\n            $(SELECTORS.SUGGESTIONS).html('');\n        });\n    };\n\n    if (!registered) {\n        ModalRegistry.register(ModalHelp.TYPE, ModalHelp, 'theme_urcourses_default/modal_help');\n        registered = true;\n    }\n\n    return ModalHelp;\n});\n"],"file":"modal_help.min.js"}