define ("theme_urcourses_default/course_request",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","theme_urcourses_default/course_actions"],function(a,b,c,d,f,g,h){var i,j,k,l,m={HEADER:"#page-header .header-body",HEADER_TOP:"#page-header .page-head",BTN_COURSETOOLS:"#btn_coursetools",BTN_DUPLICATE:"#btn_duplicate",BTN_NEW:"#btn_new",BTN_STUDENT_ACCOUNT:"#btn_student_account",BTN_STUDENT_ENROL:"#btn_student_enrol",BTN_DESCRIPTION:"#btn_editdescription"},n=function(b,c,d,e){i=a(b);j=c;l=d;k=e;h=new h(j.id,j.coursename,j.shortname,j.startdate,j.enddate,l,k)},o=function(){i.on("click",m.BTN_COURSETOOLS,p);i.on("click",m.BTN_DUPLICATE,p);i.on("click",m.BTN_NEW,p);i.on("click",m.BTN_DESCRIPTION,x);i.on("click",m.BTN_STUDENT_ACCOUNT,q);i.on("click",m.BTN_STUDENT_ENROL,u)},p=function(){var b=a(this);h.coursereqAction(b,"btn_new",j.category,j.startdate,j.enddate)},q=function(){var b=a(m.BTN_STUDENT_ACCOUNT).data("value"),c=a(m.BTN_STUDENT_ACCOUNT).data("username");if(b){r(c)}else{f.create({type:f.types.SAVE_CANCEL,title:"Create a test student for UR Courses",body:"<p>"+("<b>The following test user account will be created: </b><br><br><b>Email address </b><a class=\"btn btn-link p-0\" role=\"button\" data-toggle=\"modal\" data-placement=\"right\" data-target=\"moodle-email-modal-dialogue\" data-html=\"true\"><i class=\"icon fa fa-question-circle text-info fa-fw \" title=\"Help with test student account email\" aria-label=\"Help with test student account email\"></i></a><br>"+c+"+urstudent@uregina.ca<br><br><b>Username </b><br>"+c+"-urstudent<hr/>You can enrol this account to test and experience a course as a student.<br><br><b>Would you like to create the test student account?</b><br><label class=\"form-check  fitem  \"><input type=\"checkbox\" name=\"id_enroll_test\" class=\"form-check-input \" id=\"id_enroll_test\" value=\"1\" size=\"\" checked>Enrol test student into this course</label>")+"</p>"}).then(function(b){b.setSaveButtonText("Create");var d=b.getRoot();d.on(g.cancel,function(){});a(d).find(".fa-question-circle").parent().click(function(){f.create({type:f.types.CANCEL,title:"Help with test student account email",body:"<p>Email sent to this address will appear in your username@uregina.ca inbox</p>"}).then(function(a){a.show()})});d.on(g.save,function(b){b.preventDefault();a(d).find("button[data-action=\"save\"]").append(" <span class=\"spinner-border spinner-border-sm\" role=\"status\" aria-hidden=\"true\"></span><span class=\"sr-only\">Loading...</span>");var e=a(d).find("#id_enroll_test").is(":checked");s(c,e)});b.show()})}},r=function(d){if(!j.id){return}var e={courseid:j.id,username:d},h={methodname:"theme_urcourses_default_header_test_account_info",args:e,fail:c.exception},i=b.call([h]);i[0].done(function(b){if(0!=b.userid){info="<b>Email address </b><a class=\"btn btn-link p-0\" role=\"button\" data-toggle=\"modal\" data-placement=\"right\" data-target=\"moodle-email-modal-dialogue\" data-html=\"true\"><i class=\"icon fa fa-question-circle text-info fa-fw \" title=\"Help with test student account email\" aria-label=\"Help with test student account email\"></i></a><br>"+b.email+"<br><b>Username </b><br>"+b.username+"<br><b>Account Creation Date </b><br>"+b.datecreated+"<br/><br><div class=\"alert alert-warning d-flex justify-content-between bd-highlight \" role=\"alert\"><div class=\"\">Reset test account password </div><button id=\"test_account_reset\" type=\"button\" class=\"btn btn-primary\" >Reset Password</button></div>"}else{info="<div class=\"alert alert-warning\" role=\"alert\"> Test student account could not be found!</div>"}f.create({type:f.types.CANCEL,title:"User details for test student account",body:info}).then(function(b){var c=b.getRoot();a(c).find("button[data-action=\"cancel\"]").text("Close");a(c).find(".fa-question-circle").parent().click(function(){f.create({type:f.types.CANCEL,title:"Help with test student account email",body:"<p>Email sent to this address will appear in your username@uregina.ca inbox</p>"}).then(function(a){a.show()})});c.on(g.hidden,function(){a("#test_account_reset").remove()});b.show()}).done(function(){a("#test_account_reset").bind("click",function(){v(a(this),d)})})}).fail(function(){c.exception})},s=function(a,d){if(!j.id){return}var e={courseid:j.id,username:a,checked:d},f={methodname:"theme_urcourses_default_header_create_test_account",args:e,fail:c.exception},g=b.call([f]);g[0].done(function(a){t(a)}).fail(function(){c.exception})},t=function(b){if("undefined"!=typeof b.unenroll){title="Success: ";info="<div class=\"alert alert-success\" role=\"alert\">"+b.username+" was removed from course. </div>";if(!b.unenroll){title="ERROR:";info="<div class=\"alert alert-warning\" role=\"alert\">";info+=b.username+" could not be removed from course. </div>"}}else if("undefined"!=typeof b.reset){title="Success: ";info="<div class=\"alert alert-success\" role=\"alert\">"+b.username+" password was reset. You will recieve an email with new credentials. It may take a few minutes to process.</div>";if(!b.reset&&0!=b.userid){title="ERROR:";info="<div class=\"alert alert-warning\" role=\"alert\">";info+=b.username+"'s password could not be reset, email failed to send </div>"}else if(!b.reset&&0==b.userid){title="ERROR:";info="<div class=\"alert alert-warning\" role=\"alert\">";info+=b.username+"'s account could not be found </div>"}}else{title="Success: ";info="<div class=\"alert alert-success\" role=\"alert\">";if(!1!=b.created&&!1!=b.enrolled){info+=b.username+" was created and enrolled into this course. New account information has been emailed to you. </div>"}else if(!1!=b.created&&!1==b.enrolled){info+=b.username+" was created, but was NOT enrolled into this course. New account information has been emailed to you. </div>"}else if(!1==b.created&&!1!=b.enrolled){info+=b.username+" has been enrolled into this course.</div>"}else{title="ERROR:";info="<div class=\"alert alert-warning\" role=\"alert\">";info+=b.username+" already exists and is enrolled into the course. </div>"}}f.create({type:f.types.CANCEL,title:title,body:info}).then(function(c){var d=c.getRoot();a(d).find("button[data-action=\"cancel\"]").text("Close");d.on(g.cancel,function(){if("undefined"==typeof b.reset){location.reload()}});d.find(".close").click(function(){if("undefined"==typeof b.reset){location.reload()}});c.show()})},u=function(){var b=a(m.BTN_STUDENT_ENROL).data("value"),c=a(m.BTN_STUDENT_ENROL).data("username"),d=b?"Unenrol test student account in course":"Enrol test student account in course",e=b?"remove ":"enrol the test student account ";e=e+c+"+urstudent@uregina.ca from course";f.create({type:f.types.SAVE_CANCEL,title:d,body:"<p><b>Do you want to "+e+"?</b><br /></p>"}).then(function(d){b?d.setSaveButtonText("Remove"):d.setSaveButtonText("Enrol");var f=d.getRoot();f.on(g.cancel,function(){});f.on(g.save,function(d){d.preventDefault();a(f).find("button[data-action=\"save\"]").append(" <span class=\"spinner-border spinner-border-sm\" role=\"status\" aria-hidden=\"true\"></span><span class=\"sr-only\">Loading...</span>");b?w(c):s(c,!0)});d.show()})},v=function(d,h){f.create({type:f.types.SAVE_CANCEL,title:"Reset Password for test student account",body:"<p><b>Do you want to "+("reset the password for student account "+h+"+urstudent@uregina.ca.")+"?</b><br /></p>"}).then(function(d){d.setSaveButtonText("Reset Password");var f=d.getRoot();f.on(g.cancel,function(){});f.on(g.save,function(d){d.preventDefault();a(f).find("button[data-action=\"save\"]").append("<span class=\"spinner-border spinner-border-sm\" role=\"status\" aria-hidden=\"true\"></span><span class=\"sr-only\">Loading...</span>");var e={courseid:j.id,username:h},g={methodname:"theme_urcourses_default_header_reset_test_account",args:e,fail:c.exception},i=b.call([g]);i[0].done(function(b){a(f).find("button[data-action=\"cancel\"]").click();t(b)}).fail(function(){c.exception})});d.show()})},w=function(a){if(!j.id){return}var d={courseid:j.id,username:a},e={methodname:"theme_urcourses_default_header_unenroll_test_account",args:d,fail:c.exception},f=b.call([e]);f[0].done(function(a){t(a)}).fail(function(){c.exception})},x=function(){var a=window.location.href;a=a.substring(0,a.lastIndexOf("/"));var b=a+"/edit.php?id="+j.id+"#id_descriptionhdr";window.location.href=b},y=function(){var b=window.location.href;if(0<=b.indexOf("course/edit.php")){if(""!=window.location.hash){var c=a(".navbar").outerHeight();a("html, body").animate({scrollTop:a(window.location.hash).offset().top-c},2e3)}}};return{init:function init(a,b,c,d){n(a,b,c,d);o();y()}}});
//# sourceMappingURL=course_request.min.js.map
