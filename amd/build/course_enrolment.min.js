function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}f(void 0)})}}define ("theme_urcourses_default/course_enrolment",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","theme_urcourses_default/course_actions"],function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p={HEADER:"#page-header .header-body",HEADER_TOP:"#page-header .page-head",BTN_COURSEENROL:"#btn_courseenrol",BTN_ENROLTERM:".btn_enrolterm",STARTHOLDER:"#course_tools_startholder",ENDHOLDER:"#course_tools_endholder",STARTDAY:"#course_tools_start_day",STARTMONTH:"#course_tools_start_month",STARTYEAR:"#course_tools_start_year",STARTHOUR:"#course_tools_start_hour",STARTMINUTE:"#course_tools_start_minute",ENDDAY:"#course_tools_end_day",ENDMONTH:"#course_tools_end_month",ENDYEAR:"#course_tools_end_year",ENDHOUR:"#course_tools_end_hour",ENDMINUTE:"#course_tools_end_minute",ENDENABLE:"#course_tools_enddate_enabled",ERR_START:"#error_course_tools_start",ERR_END:"#error_course_tools_end"},q={MODAL_COURSE_ACTION_CONTENT:"theme_urcourses_default/modal_course_action_date"},r=function(b,c,d,e,f,j){h=a(b);i=c;l=d;m=e;n=f;o=j;g=new g(i.id,i.coursename,i.shortname,i.startdate,i.enddate,n,m)},s=function(){h.on("click",p.BTN_ENROLTERM,w)},t=function(){a(".tmpl-label").bind("click",function(){u(a(this))})},u=function(b){templateHolder=a("div[data-role=\"templateholder\"");if(b.hasClass("active")){b.removeClass("active");b.find(".fa-check-square-o").addClass("fa-square-o");b.find(".fa-square-o").removeClass("fa-check-square-o")}else{b.addClass("active");b.find(".fa-square-o").addClass("fa-check-square-o");b.find(".fa-check-square-o").removeClass("fa-square-o")}},v=function(){a("div[data-role=\"delete_button\"]").bind("click",function(){C(a(this))})},w=function(){j=a(this);k=j.attr("id");if(!i.id){return}var d={courseid:i.id,semester:k},e=b.call([{methodname:"theme_urcourses_default_header_enrollment_info",args:d}]);e[0].done(function(a){x(a)}).fail(function(){c.exception})},x=function(b){var c="Modify enrolment for "+b.semester;activatedlist="";activatedtitle="";isavailable=b.isavaliable;templatelist="<div class=\"form-control-feedback invalid-feedback\" id=\"error_course_tools_section\"></div> <div data-role=\"templateholder\" class = \"list-group\" >";if(0!=b.courseinfo.length){a.each(b.courseinfo,function(a,b){templatelist+="<div data-role = \"bannerselect\" class=\"tmpl-label list-group-item list-group-item-action \" id = "+b.crn+"><h6><i class=\"fa fa-square-o\" aria-hidden=\"true\"></i>  "+b.subject+" "+b.course+"-"+b.section+"</h6></div>"});templatelist+="<br><div class=\"form-check ml-3\"><input class=\"form-check-input\" type=\"checkbox\" value=\"\" id=\"course_tools_groups\"><label class=\"form-check-label\" for=\"course_tools_groups\"><h6> Create groups for each section </h6> </label> </div>"}else{templatelist+="<div data-role = \"templateselect\" class=\"tmpl-label list-group-item list-group-item-action\" id = \"0\" ><p>There are no additional sections available at this time </p></div>"}if(0!=b.activated.length){activatedtitle="<label class=\"col-form-label d-inline\"><b> Current enrolments:  </b></label></br>";activatedlist+="<div class=\"list-group\">";a.each(b.activated,function(a,b){var c="alert-warning";if(b.linked){c="alert-success"}activatedlist+="<div data-role=\"delete_button\" data-fullname =\""+b.fullname+"\" id=\"delete_"+b.crn+"_"+b.urid+"\" class=\"list-group-item list-group-item-secondary enrollment-delete "+c+" \"><h6 class =\"ml-3 d-inline\">"+b.subject+" "+b.course+"-"+b.section+"<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button></h6></div>"});activatedlist+="</div><br>"}templatelist+="</div>";e.create({type:0!=b.courseinfo.length?e.types.SAVE_CANCEL:e.types.CANCEL,title:c,body:isavailable?"<label class=\"col-form-label d-inline\"><b> Available enrolments:  </b></label></br>"+templatelist+"</br>"+activatedtitle+activatedlist:""}).then(function(c){c.footer.prepend("<a type=\"button\" class=\"btn btn-primary justify-content-start mr-auto p-2\" href=\""+o+"/blocks/urcourserequest?semester="+k+"\">My enrolment overview</a>");if(isavailable&&0!=b.courseinfo.length){c.setSaveButtonText("Save");var d=c.getRoot();d.on(f.cancel,function(){});d.on(f.save,function(c){templateHolder=a("div[data-role=\"templateholder\"");selectedTemplates=a(templateHolder).find(".active");if(0>=selectedTemplates.length){c.preventDefault();a("#error_course_tools_section").text("Please select a section");a("#error_course_tools_section").attr("display","block");a("#error_course_tools_section").show()}else{for(var d=[],e=0;e<selectedTemplates.length;e++){d.push({crn:a(selectedTemplates[e]).attr("id")})}var f=a("#course_tools_groups").prop("checked");y(b,d,f)}})}else{var d=c.getRoot();d.on(f.cancel,function(){})}d.on(f.hidden,function(){a("div[data-role='templateholder']").remove()});c.show()}).done(function(){if(isavailable){if(0<b.courseinfo.length){t(j)}else{a("button[data-action=\"cancel\"]").text("Close")}}if(0!=b.activated.length){v()}})},y=function(){var b=_asyncToGenerator(regeneratorRuntime.mark(function b(c,d,h){var m,n,o,r,s,t,u,v;return regeneratorRuntime.wrap(function(b){while(1){switch(b.prev=b.next){case 0:m=new Date().getFullYear()+1;n=new Date().getMonth()+" "+new Date().getDate()+", "+new Date().getFullYear();o=new Date().getMonth()+" "+new Date().getDate()+", "+m;r="";jQuery.each(l,function(a,b){if(a==k){var c=b.startdate.split("-"),e=b.enddate.split("-");n=parseInt(c[1],10)+" "+c[0]+", "+c[2];o=parseInt(e[1],10)+" "+e[0]+", "+e[2];var f=new Date(c[2],c[1]-1,c[0]);r=f.toLocaleString("default",{month:"short"})+" "+c[0]+", "+c[2]}});s=i.startdate.mon+" "+i.startdate.mday+", "+i.startdate.year;t=i.enddate.mon+" "+i.enddate.mday+", "+i.enddate.year;if(!(s==n&&t==o)){b.next=11;break}B(d,h,!0);b.next=18;break;case 11:u="Would you like to change course dates?";b.next=14;return self.render(q.MODAL_COURSE_ACTION_CONTENT);case 14:v=b.sent;s=i.startdate.month+" "+i.startdate.mday+", "+i.startdate.year;t=i.enddate.month+" "+i.enddate.mday+", "+i.enddate.year;e.create({type:e.types.SAVE_CANCEL,title:u,body:"<p><b>Current Course Dates:<br/></b><div class='alert alert-warning' role='alert'>"+(i.enddate.year<i.startdate.year?"Start Date: "+s+"<br> End Date: No endate set":s+" until "+t)+"</div>"+(""==r?"":"The "+c.semester+" term will begin "+r+"<br/><br/>")+v,backdrop:"static",keyboard:!1,dismissible:!1}).then(function(b){b.setSaveButtonText("Update");var c=b.getRoot();c.on(f.cancel,function(){B(d,h,!0)});c.on(f.save,function(a){if(!A()){a.preventDefault()}else{B(d,h,!1)}});b.show();modaltemp=b.modal;a(modaltemp).find(".close").attr("id","closemodal");a("#closemodal").bind("click",function(){z(a(this),b)});a(modaltemp).find(".close").addClass("dateconfirm");a(c).click(function(c){if(!a(c.target).is("button")&&!a(c.target).parent().is("button")){c.preventDefault;b.show()}else{a(p.ENDHOLDER).remove();a(p.STARTHOLDER).remove();a(p.ERR_START).remove();a(p.ERR_END).remove();b.hide()}})}).done(function(){var b={year:new Date().getFullYear(),mon:new Date().getMonth(),mday:new Date().getDate()},c={year:new Date().getFullYear()+1,mon:new Date().getMonth(),mday:new Date().getDate()};jQuery.each(l,function(a,d){if(a==k){var e=d.startdate.split("-"),f=d.enddate.split("-");b={year:e[2],mon:e[1],mday:e[0]};c={year:f[2],mon:f[1],mday:f[0]}}});a("button[data-action=\"cancel\"]").text("Continue without updating");g.populateDateSelects(b,c);g.registerDateEventListeners(j)});case 18:case"end":return b.stop();}}},b)}));return function(){return b.apply(this,arguments)}}(),z=function(b,c){a(p.ENDHOLDER).remove();a(p.STARTHOLDER).remove();a(p.ERR_START).remove();a(p.ERR_END).remove();c.hide()},A=function(){var b=a(p.STARTDAY).val(),c=a(p.STARTMONTH).val(),d=a(p.STARTYEAR).val(),e=a(p.ENDYEAR).val(),f=a(p.ENDDAY).val(),g=a(p.ENDMONTH).val(),h=!0,i=new Date(d+"."+c+"."+b).getTime()/1e3,j=new Date(e+"."+g+"."+f).getTime()/1e3;if(j<i&&a(p.ENDENABLE).is(":checked")){a(p.ERR_START).text("Course end date can not be before start date");a(p.ERR_START).attr("display","block");a(p.ERR_START).show();h=!1}else{a(p.ERR_START).text("");a(p.ERR_END).text("")}return h},B=function(d,g,h){if(!i.id){return}if(h){var j=i.startdate.mday+"-"+i.startdate.mon+"-"+i.startdate.year+"-"+i.startdate.hours+"-"+i.startdate.minutes,l=i.enddate.mday+"-"+i.enddate.mon+"-"+i.enddate.year+"-"+i.enddate.hours+"-"+i.enddate.minutes}else{var m=a(p.STARTDAY).val(),n=a(p.STARTMONTH).val(),o=a(p.STARTYEAR).val(),q=a(p.STARTHOUR).val(),r=a(p.STARTMINUTE).val(),j=m+"-"+n+"-"+o+"-"+q+"-"+r,l="0";if(a(p.ENDENABLE).is(":checked")){var s=a(p.ENDDAY).val(),t=a(p.ENDMONTH).val(),u=a(p.ENDYEAR).val(),v=a(p.ENDHOUR).val(),w=a(p.ENDMINUTE).val();l=s+"-"+t+"-"+u+"-"+v+"-"+w}}if(""==g||!1==g){g=0}else{g=1}var x={courseid:i.id,semester:k,crns:d,groupcheck:g,startdate:j,enddate:l},y={methodname:"theme_urcourses_default_header_activate_course",args:x,fail:c.exception},z=b.call([y]);z[0].done(function(b){var c="ERROR:";info="<div class=\"alert alert-warning\" role=\"alert\">"+b.result+"<br></div>";if(""!=b.result){c="Enrolment assigned successfully";info="<div class=\"alert alert-success\" role=\"alert\">"+b.result+"<br></div>"}e.create({type:e.types.CANCEL,title:c,body:info}).then(function(b){b.show();var c=b.getRoot();a("button[data-action=\"cancel\"]").text("Close");c.on(f.hidden,function(){location.reload()})})}).fail(function(){c.exception})},C=function(a){var b=a.data("fullname");e.create({type:e.types.SAVE_CANCEL,title:"Delete Enrolment",body:"<p><b>Are you sure you want to delete enrolment for "+b+"?</b><br />"}).then(function(b){b.setSaveButtonText("Delete");var c=b.getRoot();c.on(f.cancel,function(){});c.on(f.save,function(){D(a)});b.show()})},D=function(d){var g=d.attr("id").split("_"),h={courseid:g[2],semester:k,crn:g[1]},i={methodname:"theme_urcourses_default_header_delete_enrollment",args:h,fail:c.exception},j=b.call([i]);j[0].done(function(b){a("button[data-action=\"cancel\"] ").trigger("click");var c="ERROR:";info="<div class=\"alert alert-warning\" role=\"alert\">"+b.result+"<br></div>";if(""!=b.result){c="Successfully Removed Enrolment";info="<div class=\"alert alert-success\" role=\"alert\">"+b.result+"<br></div>"}e.create({type:e.types.CANCEL,title:c,body:info}).then(function(b){b.show();var c=b.getRoot();c.on(f.hidden,function(){location.reload()});a("button[data-action=\"cancel\"]").text("Close")})}).fail(function(){c.exception})};return{init:function init(a,b,c,d,e,f){r(a,b,c,d,e,f);s()}}});
//# sourceMappingURL=course_enrolment.min.js.map
