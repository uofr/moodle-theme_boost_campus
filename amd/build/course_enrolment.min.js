define ("theme_urcourses_default/course_enrolment",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f){var g,h,i,j,k,l,m={HEADER:"#page-header .header-body",HEADER_TOP:"#page-header .page-head",BTN_COURSEENROL:"#btn_courseenrol",BTN_ENROLTERM:".btn_enrolterm"},n=function(b,c,d,e){g=a(b);h=c;i=d;j=e},o=function(){g.on("click",m.BTN_ENROLTERM,r)},p=function(){a(".tmpl-label").bind("click",function(){s(a(this))})},q=function(){a("#btn_duplicatemodal").bind("click",function(){v(a(this))});a("#btn_newmodal").bind("click",function(){v(a(this))})},r=function(){k=a(this);l=k.attr("id");if(!h){return}var d={courseid:h,semester:l},e=b.call([{methodname:"theme_urcourses_default_header_enrollment_info",args:d}]);e[0].done(function(a){t(a)}).fail(function(){c.exception})},s=function(b){templateHolder=a("div[data-role=\"templateholder\"");a(templateHolder).find(".active").removeClass("active");b.addClass("active")},t=function(b){var c="Modify enrolment for "+b.semester;activatedlist="";activatedtitle="";isavailable=b.isavaliable;if(!1==isavailable){output="<div class=\"d-flex justify-content-center\"><div id= \"mainspinner\" class=\"spinner-border \" role=\"status\"style=\"display: none;\" ><span class=\"sr-only\">Loading...</span></div></div><div id=\"infoholder\" class=\"\">";output+="<div class=\"alert alert-warning\" role=\"alert\">This course was used in a different semester. Please choose one of the following options:</div>";output+="<button class=\"btn btn-secondary\" id=\"btn_duplicatemodal\" type=\"button\"><i class=\"fa fa-files-o\" aria-hidden=\"true\"></i>Duplicate this course</button>";output+="<button class=\"btn btn-secondary\" id=\"btn_newmodal\"style=\"float: right;\" type=\"button\"><i class=\"fa fa-plus\" aria-hidden=\"true\"></i> Create blank course</button> </div></div>"}else{if(0!=b.activated.length){activatedtitle="<small>The following Banner sections are already enrolled for the selected term:</small>";activatedlist+="<div class=\"list-group\">";a.each(b.activated,function(a,b){activatedlist+="<div class=\"list-group-item list-group-item-secondary\"><h6>"+b.subject+" "+b.course+"-"+b.section+"</h6></div>"});activatedlist+="</div><br>"}templatelist="<div data-role=\"templateholder\" class = \"list-group\" >";if(0!=b.courseinfo.length){if(6<b.courseinfo.length){templatelist+="<label  class=\"col-form-label d-inline \" for=\"bannerselect\">Select Banner Section:</label><br> ";templatelist+="<div class=\"form-control-feedback invalid-feedback\" id=\"error_bannerselect\"></div> ";templatelist+="<select class=\"custom-select\" id=\"bannerselect\" ";a.each(b.courseinfo,function(a,b){templatelist+="<option value = "+b.subject+" "+b.course+"-"+b.section+"</option>"});templatelist+="</select>"}else{count=1;a.each(b.courseinfo,function(a,b){if(1==count){templatelist+="<div data-role = \"bannerselect\" class=\"tmpl-label list-group-item list-group-item-action active\" id = "+b.crn+"><h6>"+b.subject+" "+b.course+"-"+b.section+"</h6></div>"}else{templatelist+="<div data-role = \"bannerselect\" class=\"tmpl-label list-group-item list-group-item-action \" id = "+b.crn+"><h6>"+b.subject+" "+b.course+"-"+b.section+"</h6></div>"}count++})}}else{templatelist+="<div data-role = \"templateselect\" class=\"tmpl-label list-group-item list-group-item-action active\" id = \"0\" ><p>There are no available Banner Sections for this course </p></div>"}templatelist+="</div>"}e.create({type:e.types.SAVE_CANCEL,title:c,body:isavailable?"<p><b>Are you sure you want to modify enrolment for this course?</b><br />"+activatedtitle+activatedlist+"<small>The following CRNs are available for the selected term:</small>"+templatelist+"</p>":output}).then(function(c){if(isavailable){c.setSaveButtonText("Save");var d=c.getRoot();d.on(f.cancel,function(){});d.on(f.save,function(){u(b.courseinfo)})}else{var d=c.getRoot();d.on(f.cancel,function(){})}d.on(f.hidden,function(){a("div[data-role='templateholder']").remove()});c.show()}).done(function(){if(isavailable){if(6>b.courseinfo.length&&0<b.courseinfo.length){p(k)}}else{q()}})},u=function(d){if(!h){return}if(6<d.length){templateid=a("#bannerselect").val()}else{templateHolder=a("div[data-role=\"templateholder\"");selectedTemplate=a(templateHolder).find(".active");templateid=a(selectedTemplate).attr("id")}if(0!=templateid){var f={courseid:h,semester:l,crn:templateid},g={methodname:"theme_urcourses_default_header_activate_course",args:f,fail:c.exception},i=b.call([g]);i[0].done(function(b){if(""!=b.result){title="Response:";info=b.result}if(b.value){messageHolder=a("#enrollment_span");messageHolder.text("Enrolment: "+b.semester)}e.create({title:title,body:"<p><b>"+info+"</b><br></p>"}).done(function(a){a.show()})}).fail(function(){c.exception})}},v=function(b){var c="btn_newmodal"==b.attr("id")?"Create new course":"Duplicate this course",d="btn_newmodal"==b.attr("id")?"create a new":"duplicate this";templatenew="<div data-role=\"templateholder\" class = \"list-group\" >";if(0!=_templatelist){if(6<_templatelist.length){templatenew+="<label  class=\"col-form-label d-inline \" for=\"templateselect\">Template Select:</label><br> ";templatenew+="<div class=\"form-control-feedback invalid-feedback\" id=\"error_templateselect\"></div> ";templatenew+="<select class=\"custom-select\" id=\"templateselect\" ";templatenew+="<option value = 0 > Default Blank Course</option>";templatenew+="<option value = 0 > Default Blank Course</option>";a.each(_templatelist,function(a,b){templatenew+="<option value = "+b.id+">"+b.fullname+"</option>"});templatenew+="</select>"}else{a.each(_templatelist,function(a,b){templatenew+="<div data-role = \"templateselect\" class=\"tmpl-label list-group-item list-group-item-action \" id = "+b.id+"><h6>"+b.fullname+"</h6><p><small>"+b.summary+"</small></p></div>"});templatenew+="<div data-role = \"templateselect\" class=\"tmpl-label list-group-item list-group-item-action active\" id = \"0\" ><h6>Default Course</h6><p><small>Basic course template. No activites included </small></p></div>"}}else{templatenew+="<div data-role = \"templateselect\" class=\"tmpl-label list-group-item list-group-item-action active\" id = \"0\" ><h6>Default Course</h6><p><small>Basic course template. No activites included </small></p></div>"}templatebase="</div>";templatebase+="<br><br>";templatebase+="<div class=\"form-control-feedback invalid-feedback\" id=\"error_coursename\"></div> ";templatebase+="<label  class=\"col-form-label d-inline \" for=\"coursename\">Course Full Name:</label><input maxlength=\"254\" class=\"form-control \" type=\"text\" id=\"coursename\" name=\"coursename\"><br> ";templatebase+="<div class=\"form-control-feedback invalid-feedback\" id=\"error_shortname\"></div> ";templatebase+="<label class=\"col-form-label d-inline \" for=\"shortname\">Course Short Name:</label><input maxlength=\"254\" class=\"form-control \" type=\"text\" id=\"shortname\" name=\"shortname\"><br> ";templatebase+="<label  class=\"col-form-label d-inline \" for=\"category\">Course Category:</label><br> ";templatebase+="<div class=\"form-control-feedback invalid-feedback\" id=\"error_category\"></div> ";templatebase+="<select class=\"custom-select\" id=\"category\" ";if(0!=_categories){a.each(_categories,function(a,b){templatebase+="<option value = "+b.id+">"+b.name+"</option>"})}templatebase+="</select";templatenew+=templatebase;templateduplicate=templatebase;e.create({type:e.types.SAVE_CANCEL,title:c,body:"<p><b>Are you sure you want to "+d+" course?</b><br />"+("btn_newmodal"==b.attr("id")?"<small>Select from the templates below:</small>":"<small>Student data will not be included in the duplicated course.</small>")+("btn_newmodal"==b.attr("id")?templatenew:"")+(!("btn_newmodal"==b.attr("id"))?templateduplicate:"")+"</p>"}).then(function(c){c.setSaveButtonText("btn_newmodal"==b.attr("id")?"Create new course":"Duplicate this course");var d=c.getRoot();d.on(f.cancel,function(){});if("btn_newmodal"==b.attr("id")){d.on(f.save,function(a){if(!w()){a.preventDefault()}else{x(b.attr("id"))}})}else{d.on(f.save,function(a){if(!w()){a.preventDefault()}else{y(b.attr("id"))}})}d.on(f.hidden,function(){a("#coursename").remove();a("#shortname").remove();a("#category").remove()});c.show()}).done(function(){if("btn_newmodal"==b.attr("id")){p(b)}else{a("#coursename").val(i+" (Copy)");a("#shortname").val(j+" (Copy)")}})},s=function(b){templateHolder=a("div[data-role=\"templateholder\"");a(templateHolder).find(".active").removeClass("active");b.addClass("active")},w=function(){coursename=a("#coursename").val();shortname=a("#shortname").val();error_coursename=a("#error_coursename");error_shortname=a("#error_shortname");var b=!0;if(0==coursename.length){a(error_coursename).text("Please enter a name for the course");a(error_coursename).attr("display","block");a(error_coursename).show();b=!1}if(0==shortname.length){a(error_shortname).text("Please enter a short name for the course");a(error_shortname).attr("display","block");a(error_shortname).show();b=!1}if(!b){return!1}a(error_coursename).text("");a(error_shortname).text("");return!0},x=function(){if(!h){return}if(6<_templatelist.length){templateid=a("#templateselect").val()}else{templateHolder=a("div[data-role=\"templateholder\"");selectedTemplate=a(templateHolder).find(".active");templateid=a(selectedTemplate).attr("id")}coursename=a("#coursename").val();shortname=a("#shortname").val();categoryid=a("#category").val();a("#mainspinner").show();a("#infoholder").addClass("block_urcourserequest_overlay");var d={courseid:h,templateid:templateid,coursename:coursename,shortname:shortname,categoryid:categoryid},f={methodname:"theme_urcourses_default_header_create_course",args:d,fail:c.exception},g=b.call([f]);g[0].done(function(b){a("#mainspinner").hide();a("#infoholder").removeClass("block_urcourserequest_overlay");if(""!=b.error){title="ERROR:";info=b.error;e.create({title:title,body:"<p><b>"+info+"</b><br></p>"}).done(function(a){a.show()})}if(""!=b.url){window.location.href=b.url}}).fail(function(){c.exception})},y=function(){if(!h){return}coursename=a("#coursename").val();shortname=a("#shortname").val();categoryid=a("#category").val();a("#mainspinner").show();a("#infoholder").addClass("block_urcourserequest_overlay");var d={courseid:h,coursename:coursename,shortname:shortname,categoryid:categoryid},f={methodname:"theme_urcourses_default_header_duplicate_course",args:d,fail:c.exception},g=b.call([f]);g[0].done(function(b){a("#mainspinner").hide();a("#infoholder").removeClass("block_urcourserequest_overlay");if(""!=b.error){title="ERROR:";info=b.error;e.create({title:title,body:"<p><b>"+info+"</b><br></p>"}).done(function(a){a.show()})}if(""!=b.url){window.location.href=b.url}}).fail(function(){c.exception})};return{init:function init(a,b,c,d){n(a,b,c,d);o()}}});
//# sourceMappingURL=course_enrolment.min.js.map
